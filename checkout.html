<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ - Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --danger: #f72585;
            --success: #4ade80;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --radius: 12px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            padding-top: 90px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo img {
            height: 60px;
            filter: drop-shadow(0 2px 10px rgba(76, 201, 240, 0.4));
        }

        /* Progress Steps */
        .checkout-progress {
            margin: 30px 0;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 40px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            right: 0;
            left: 0;
            height: 2px;
            background: var(--gray);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--dark);
            border: 2px solid var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .step.active .step-number {
            background: var(--primary);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.4);
        }

        .step-label {
            font-weight: 500;
            color: var(--gray-light);
        }

        .step.active .step-label {
            color: var(--accent);
            font-weight: bold;
        }

        /* Main Content */
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin: 40px 0;
        }

        /* Order Summary */
        .order-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .order-summary h3 {
            margin-bottom: 25px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .order-item {
            display: grid;
            grid-template-columns: 60px 1fr auto;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-image img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .item-details h5 {
            margin-bottom: 5px;
        }

        .item-total {
            font-weight: bold;
            color: var(--accent);
        }

        .summary-totals {
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row.discount {
            color: var(--success);
            font-weight: bold;
        }

        .summary-row.original-total {
            text-decoration: line-through;
            color: var(--gray-light);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .summary-row.final-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--success);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Shipping Note */
        .shipping-note {
            margin-top: 20px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .shipping-note i {
            color: #3b82f6;
            margin-left: 5px;
        }

        .shipping-note span {
            font-size: 0.9rem;
            color: #93c5fd;
        }

        /* Discount Success */
        .discount-success {
            margin-top: 20px;
            padding: 15px;
            background: rgba(74, 222, 128, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(74, 222, 128, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .discount-success.show {
            display: block;
        }

        .discount-success i {
            color: var(--success);
            margin-left: 5px;
        }

        .discount-success span {
            font-size: 0.9rem;
            color: #86efac;
        }

        /* Checkout Form */
        .checkout-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkout-title {
            margin-bottom: 30px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            margin-bottom: 20px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-light);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        .form-group select {
            background: #1e293b !important;
            color: var(--light) !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        .form-group select option {
            background: #1e293b !important;
            color: var(--light) !important;
            padding: 10px !important;
        }

        .form-group select:focus option {
            background: #0f172a !important;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* City Container */
        .city-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-method {
            position: relative;
        }

        .payment-method input {
            position: absolute;
            opacity: 0;
        }

        .payment-method label {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method input:checked + label {
            border-color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
        }

        .payment-method label:hover {
            border-color: var(--accent);
        }

        .payment-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent);
        }

        .payment-info h4 {
            margin-bottom: 5px;
        }

        .payment-info p {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        /* Discount Input */
        .discount-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .discount-input-container input {
            flex: 1;
        }

        .btn-discount {
            background: var(--success);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .btn-discount:hover:not(:disabled) {
            background: #16a34a;
            transform: translateY(-2px);
        }

        .btn-discount:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Payment Alert */
        .payment-alert {
            margin-top: 15px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(245, 158, 11, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-alert.show {
            display: block;
        }

        .payment-alert i {
            color: var(--warning);
            margin-left: 5px;
        }

        .payment-alert span {
            font-size: 0.9rem;
            color: #fcd34d;
        }

        /* Country Selection */
        .country-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
        }

        .country-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            width: 250px;
            background: rgba(255, 255, 255, 0.05);
        }

        .country-option:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(76, 201, 240, 0.2);
        }

        .country-option.selected {
            border-color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
        }

        .country-flag {
            font-size: 3.5rem;
        }

        .country-name {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .country-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 30px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        /* Footer */
        .footer {
            background: var(--dark);
            padding: 40px 0;
            margin-top: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-bottom {
            text-align: center;
            color: var(--gray);
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .order-summary {
                position: static;
                margin-bottom: 30px;
            }
            
            .city-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .country-options {
                flex-direction: column;
                align-items: center;
            }
            
            .country-option {
                width: 100%;
                max-width: 300px;
            }
            
            body {
                padding-top: 80px;
            }
            
            .payment-method label {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                padding: 15px;
            }
            
            .payment-info {
                text-align: center;
            }
            
            .discount-input-container {
                flex-direction: column;
            }
            
            .btn-discount {
                width: 100%;
                padding: 12px;
            }
        }

        @media (max-width: 576px) {
            .checkout-form,
            .order-summary {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="logo-removebg-preview.png" alt="Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù">
                </div>
                <a href="cart.html" style="color: var(--light); text-decoration: none;">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ù„Ø©
                </a>
            </div>
        </div>
    </header>

    <!-- Checkout Progress -->
    <div class="checkout-progress">
        <div class="container">
            <div class="progress-steps">
                <div class="step active" id="step1">
                    <div class="step-number">Ù¡</div>
                    <div class="step-label">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">Ù¢</div>
                    <div class="step-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">Ù£</div>
                    <div class="step-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Step 1: Country Selection -->
        <div id="step1-content" class="step-content">
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 style="color: var(--accent); margin-bottom: 15px;">
                    <i class="fas fa-globe"></i> Ø§Ø®ØªØ± Ø¨Ù„Ø¯ Ø§Ù„Ø´Ø­Ù†
                </h1>
                <p style="color: var(--gray-light); font-size: 1.1rem;">
                    Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±
                </p>
            </div>

            <div class="country-options">
                <div class="country-option" onclick="selectCountry('Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 100)">
                    <div class="country-flag">ğŸ‡¸ğŸ‡¦</div>
                    <div class="country-name">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                    <div class="country-price">100 Ø±.Ø³</div>
                    <small style="color: var(--gray-light);">ÙŠØ´Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</small>
                </div>
                
                <div class="country-option" onclick="selectCountry('Ù…ØµØ±', 320)">
                    <div class="country-flag">ğŸ‡ªğŸ‡¬</div>
                    <div class="country-name">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                    <div class="country-price">320 Ø¬.Ù…</div>
                    <small style="color: var(--gray-light);">ÙŠØ´Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-primary" id="continueBtn" onclick="continueToStep2()" disabled>
                    <i class="fas fa-arrow-left"></i> Ø§Ù„ØªØ§Ù„ÙŠ: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                </button>
            </div>
        </div>

        <!-- Step 2 & 3: Checkout Form -->
        <div id="step23-content" class="step-content" style="display: none;">
            <div class="checkout-container">
                <!-- Order Summary -->
                <div class="order-summary">
                    <h3><i class="fas fa-shopping-bag"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
                    
                    <div class="order-items" id="orderItems">
                        <!-- Items will be loaded here -->
                    </div>
                    
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                            <span id="subtotal">Ù </span>
                        </div>
                        <div class="summary-row">
                            <span>Ø§Ù„Ø´Ø­Ù†:</span>
                            <span id="shipping">Ù </span>
                        </div>
                        
                        <!-- Original Total -->
                        <div class="summary-row original-total" id="originalTotalRow" style="display: none;">
                            <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ:</span>
                            <span id="originalTotal">Ù </span>
                        </div>
                        
                        <!-- Discount Applied -->
                        <div class="summary-row discount" id="discountRow" style="display: none;">
                            <span id="discountText"></span>
                            <span id="discountAmount"></span>
                        </div>
                        
                        <!-- Final Total -->
                        <div class="summary-row final-total" id="finalTotalRow">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                            <span id="total">Ù </span>
                        </div>
                    </div>
                    
                    <div class="shipping-note" id="shippingNote">
                        <i class="fas fa-info-circle"></i>
                        <span id="shippingText">Ø§Ù„Ø´Ø­Ù† ÙŠØ­Ø¯Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</span>
                    </div>
                    
                    <!-- Discount Success Message -->
                    <div class="discount-success" id="discountSuccess">
                        <i class="fas fa-gift"></i>
                        <span id="discountSuccessText"></span>
                    </div>
                </div>

                <!-- Checkout Form -->
                <div class="checkout-form">
                    <h1 class="checkout-title">
                        <i class="fas fa-credit-card"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨
                    </h1>

                    <form id="checkoutForm">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </h3>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                                    <input type="text" id="fullName" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                    <input type="tel" id="phone" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                <input type="email" id="email" required>
                                <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 5px;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯</small>
                            </div>
                        </div>

                        <!-- Shipping Address -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-map-marker-alt"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†
                            </h3>
                            
                            <div class="form-group">
                                <label for="country">Ø§Ù„Ø¨Ù„Ø¯ *</label>
                                <select id="countrySelect" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯</option>
                                    <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                                    <option value="Ù…ØµØ±">Ù…ØµØ±</option>
                                </select>
                            </div>
                            
                            <div class="city-container">
                                <div class="form-group">
                                    <label for="governorate">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© *</label>
                                    <select id="governorate" required>
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label>
                                    <input type="text" id="city" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                                <textarea id="address" rows="3" required placeholder="Ø§Ù„Ø­ÙŠ - Ø§Ù„Ø´Ø§Ø±Ø¹ - Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ - Ø§Ù„Ø´Ù‚Ø©"></textarea>
                            </div>
                        </div>

                        <!-- Discount Code -->
                        <div class="form-section" id="discountSection">
                            <h3 class="section-title">
                                <i class="fas fa-tag"></i> ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
                            </h3>
                            
                            <div class="form-group">
                                <div class="discount-input-container">
                                    <input type="text" id="discountCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…">
                                    <button type="button" class="btn-discount" id="applyDiscountBtn" onclick="applyDiscount()">
                                        ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
                                    </button>
                                </div>
                                <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 5px;">
                                    <strong>Ù„Ù…ØµØ±:</strong> ÙƒÙˆØ¯ DIFEG10 - Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ<br>
                                    <strong>Ù„Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©:</strong> ÙƒÙˆØ¯ DIFSA10 - Ø®ØµÙ… 50% Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                </small>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                            </h3>
                            
                            <div class="payment-methods" id="paymentMethods">
                                <!-- Payment methods will be loaded based on country -->
                            </div>
                            
                            <!-- Payment Alert -->
                            <div class="payment-alert" id="paymentAlert">
                                <i class="fas fa-exclamation-circle"></i>
                                <span id="paymentAlertText"></span>
                            </div>
                        </div>

                        <!-- Terms -->
                        <div class="form-group">
                            <input type="checkbox" id="terms" required style="margin-left: 10px;">
                            <label for="terms">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</label>
                        </div>

                        <button type="submit" class="btn btn-primary" id="submitOrderBtn">
                            <i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 style="color: var(--success); margin-bottom: 15px;">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <p id="orderDetails" style="margin-bottom: 30px; line-height: 1.6;">
                Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong id="orderId">#</strong><br>
                Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-primary" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
                
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© <span id="currentYear">2025</span> | Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù | Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ©</p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyADyJbkYryUHvfoLHHu1GVJkIvLcHg7cr4",
            authDomain: "different-store-d935d.firebaseapp.com",
            projectId: "different-store-d935d",
            storageBucket: "different-store-d935d.firebasestorage.app",
            messagingSenderId: "148780624236",
            appId: "1:148780624236:web:e92420a6423731d9e92b49"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Global Variables
        let cart = [];
        let selectedCountry = '';
        let selectedPrice = 0;
        let shippingCost = 0;
        let isDiscountApplied = false;
        let discountAmount = 0;
        let originalTotal = 0;
        let finalTotal = 0;
        let appliedDiscountCode = '';
        
        // Valid Discount Codes - Country Specific
        const discountCodes = {
            'Ù…ØµØ±': [
                {
                    code: 'DIFEG10',
                    description: 'Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ',
                    discountType: 'percentage',
                    discountValue: 20,
                    freeShipping: true
                }
            ],
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                {
                    code: 'DIFSA10',
                    description: 'Ø®ØµÙ… 50% Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                    discountType: 'percentage',
                    discountValue: 50,
                    freeShipping: false
                }
            ]
        };
        
        // Governorates Data
        const governorates = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                "Ø§Ù„Ø±ÙŠØ§Ø¶",
                "Ø¬Ø¯Ø©",
                "Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©",
                "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©",
                "Ø§Ù„Ø¯Ù…Ø§Ù…",
                "Ø§Ù„Ø®Ø¨Ø±",
                "Ø§Ù„Ø·Ø§Ø¦Ù",
                "ØªØ¨ÙˆÙƒ",
                "Ø£Ø¨Ù‡Ø§",
                "Ø­Ø§Ø¦Ù„",
                "Ø§Ù„Ø¨Ø§Ø­Ø©",
                "Ø§Ù„Ø¬ÙˆÙ",
                "Ù†Ø¬Ø±Ø§Ù†",
                "Ø¹Ø±Ø¹Ø±",
                "Ø³ÙƒØ§ÙƒØ§",
                "Ø§Ù„Ù‚Ø±ÙŠØ§Øª",
                "Ø§Ù„Ø®Ø±Ø¬",
                "Ø§Ù„Ù‡ÙÙˆÙ",
                "Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©",
                "Ø§Ù„Ù‚ÙˆÙŠØ¹ÙŠØ©",
                "ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¯ÙˆØ§Ø³Ø±",
                "Ø¨ÙŠØ´Ø©",
                "Ø§Ù„Ù†Ù…Ø§Øµ",
                "Ù…Ø­Ø§ÙŠÙ„ Ø¹Ø³ÙŠØ±",
                "Ø¸Ù‡Ø±Ø§Ù† Ø§Ù„Ø¬Ù†ÙˆØ¨",
                "Ø·Ø±ÙŠÙ",
                "Ø¶Ø¨Ø§Ø¡",
                "Ø§Ù„Ù„ÙŠØ«",
                "Ø§Ù„Ù‚Ù†ÙØ°Ø©",
                "Ø§Ù„ÙˆØ¬Ù‡",
                "Ø­Ù‚Ù„",
                "Ø¨Ø¯Ø±",
                "Ù…Ù‡Ø¯ Ø§Ù„Ø°Ù‡Ø¨",
                "Ø§Ù„Ø±Ø³",
                "Ø§Ù„Ø¯ÙˆØ§Ø¯Ù…ÙŠ",
                "Ø§Ù„Ù…Ø²Ø§Ø­Ù…ÙŠØ©",
                "Ø¶Ø±Ù…Ø§",
                "Ø­ÙˆØ·Ø© Ø¨Ù†ÙŠ ØªÙ…ÙŠÙ…",
                "Ø§Ù„Ø£ÙÙ„Ø§Ø¬",
                "Ø§Ù„ØºØ§Ø·",
                "Ø­ÙˆØ·Ø© Ø³Ø¯ÙŠØ±",
                "Ø§Ù„Ø²Ù„ÙÙŠ",
                "Ø´Ù‚Ø±Ø§Ø¡",
                "Ø§Ù„Ø¯Ù„Ù…",
                "Ø§Ù„Ø³Ù„ÙŠÙ„",
                "Ø§Ù„Ø®ÙØ¬ÙŠ",
                "Ø±Ø§Ø¨Øº",
                "Ø«ÙˆÙ„",
                "Ø§Ù„Ø¹Ù„Ø§",
                "Ø§Ù„Ø¨Ø¯Ø§Ø¦Ø¹",
                "Ø±Ø£Ø³ ØªÙ†ÙˆØ±Ø©",
                "ØªÙŠÙ…Ø§Ø¡",
                "Ø£Ù…Ù„Ø¬",
                "Ø§Ù„Ø¬Ø¨ÙŠÙ„",
                "ÙŠÙ†Ø¨Ø¹",
                "Ø§Ù„Ø¹Ù‚ÙŠÙ‚",
                "Ø§Ù„Ø¬Ù…ÙˆÙ…",
                "Ø®Ù„ÙŠØµ",
                "Ø§Ù„ÙƒØ§Ù…Ù„",
                "Ø±Ù†ÙŠØ©",
                "ØªØ±Ø¨Ø©",
                "Ø§Ù„Ø®ÙØ¬ÙŠ",
                "Ø§Ù„Ù†Ø¹ÙŠØ±ÙŠØ©",
                "Ø§Ù„Ù‚Ø±ÙŠÙ†",
                "Ø§Ù„ØµÙˆÙŠØ±Ø©",
                "Ø§Ù„Ø­Ø±ÙŠÙ‚",
                "Ù…Ø±Ø§Øª",
                "Ø«Ø§Ø¯Ù‚",
                "Ø§Ù„Ø­Ø§Ø¦Ø·",
                "Ø¨Ù‚ÙŠÙ‚",
                "Ø§Ù„Ø·Ø±Ù",
                "Ø§Ù„Ù‚Ø·ÙŠÙ",
                "Ø¹Ù†Ùƒ",
                "ØµÙÙˆÙ‰",
                "ØªØ§Ø±ÙˆØª",
                "Ø§Ù„Ø³Ù†Ø¨Ù„Ø©",
                "Ø§Ù„Ø¹Ù…Ø§Ø±ÙŠØ©",
                "Ø§Ù„Ø¹Ø§Ø±Ø¶",
                "Ø§Ù„Ù…Ø±Ø¯Ù…Ø©",
                "Ø§Ù„Ø®ÙˆØ¨Ø©",
                "Ø§Ù„Ø¹Ø§Ø±Ø¶",
                "Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©",
                "Ø§Ù„Ø³ÙØ§Ù†ÙŠØ©",
                "Ø§Ù„Ù‚ÙˆØ²",
                "Ø£Ø®Ø±Ù‰"
            ],
            'Ù…ØµØ±': [
                "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©",
                "Ø§Ù„Ø¬ÙŠØ²Ø©",
                "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©",
                "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©",
                "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±",
                "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©",
                "Ø§Ù„ÙÙŠÙˆÙ…",
                "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
                "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©",
                "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©",
                "Ø§Ù„Ù…Ù†ÙŠØ§",
                "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©",
                "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
                "Ø§Ù„Ø³ÙˆÙŠØ³",
                "Ø£Ø³ÙˆØ§Ù†",
                "Ø£Ø³ÙŠÙˆØ·",
                "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ",
                "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯",
                "Ø¯Ù…ÙŠØ§Ø·",
                "Ø³ÙˆÙ‡Ø§Ø¬",
                "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡",
                "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®",
                "Ù…Ø·Ø±ÙˆØ­",
                "Ø§Ù„Ø£Ù‚ØµØ±",
                "Ù‚Ù†Ø§",
                "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡",
                "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©",
                "Ø§Ù„ØºØ±Ø¨ÙŠØ©",
                "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®",
                "Ø§Ù„ÙÙŠÙˆÙ…",
                "Ø£Ø³ÙˆØ§Ù†",
                "Ø£Ø®Ø±Ù‰"
            ]
        };

        // Payment Methods Configuration
        const paymentMethods = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                {
                    id: 'bank-transfer',
                    name: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ',
                    icon: 'fas fa-university',
                    description: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'stc-pay',
                    name: 'STC Pay',
                    icon: 'fas fa-mobile-alt',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± STC Pay',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… STC Pay Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'cod',
                    name: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
                    icon: 'fas fa-money-bill-wave',
                    description: 'Ø§Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬',
                    alert: 'Ø³ØªÙ‚ÙˆÙ… Ø¨Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯'
                }
            ],
            'Ù…ØµØ±': [
                {
                    id: 'vodafone-cash',
                    name: 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                    icon: 'fas fa-mobile-alt',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'instapay',
                    name: 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                    icon: 'fas fa-credit-card',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'cod',
                    name: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
                    icon: 'fas fa-money-bill-wave',
                    description: 'Ø§Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬',
                    alert: 'Ø³ØªÙ‚ÙˆÙ… Ø¨Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯'
                }
            ]
        };

        // Shipping Costs
        const shippingPrices = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
                'Ø§Ù„Ø±ÙŠØ§Ø¶': 15,
                'Ø¬Ø¯Ø©': 20,
                'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©': 20,
                'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': 25,
                'Ø§Ù„Ø¯Ù…Ø§Ù…': 25,
                'Ø§Ù„Ø®Ø¨Ø±': 25,
                'Ø§Ù„Ø·Ø§Ø¦Ù': 30,
                'ØªØ¨ÙˆÙƒ': 35,
                'Ø£Ø¨Ù‡Ø§': 35,
                'Ø­Ø§Ø¦Ù„': 40,
                'Ø§Ù„Ø¨Ø§Ø­Ø©': 40,
                'Ø§Ù„Ø¬ÙˆÙ': 45,
                'Ù†Ø¬Ø±Ø§Ù†': 45,
                'Ø¹Ø±Ø¹Ø±': 50,
                'Ø³ÙƒØ§ÙƒØ§': 50,
                'default': 30
            },
            'Ù…ØµØ±': {
                'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©': 30,
                'Ø§Ù„Ø¬ÙŠØ²Ø©': 30,
                'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©': 40,
                'Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©': 50,
                'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±': 80,
                'Ø§Ù„Ø¨Ø­ÙŠØ±Ø©': 45,
                'Ø§Ù„ÙÙŠÙˆÙ…': 60,
                'Ø§Ù„ØºØ±Ø¨ÙŠØ©': 40,
                'Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©': 70,
                'Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©': 40,
                'Ø§Ù„Ù…Ù†ÙŠØ§': 65,
                'Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©': 35,
                'Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯': 120,
                'Ø§Ù„Ø³ÙˆÙŠØ³': 75,
                'Ø£Ø³ÙˆØ§Ù†': 100,
                'Ø£Ø³ÙŠÙˆØ·': 80,
                'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ': 70,
                'Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯': 85,
                'Ø¯Ù…ÙŠØ§Ø·': 60,
                'Ø³ÙˆÙ‡Ø§Ø¬': 90,
                'Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡': 130,
                'ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®': 50,
                'Ù…Ø·Ø±ÙˆØ­': 110,
                'Ø§Ù„Ø£Ù‚ØµØ±': 95,
                'Ù‚Ù†Ø§': 85,
                'Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡': 125,
                'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©': 45,
                'Ø£Ø®Ø±Ù‰': 70,
                'default': 60
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load cart from localStorage
            cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            // Set current year
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // If cart is empty, redirect to cart page
            if (cart.length === 0) {
                window.location.href = 'cart.html';
                return;
            }
            
            // Start from step 1 - country selection
            // Clear any previous country selection
            localStorage.removeItem('selectedCountry');
            selectedCountry = '';
            
            // Hide checkout form, show country selection
            document.getElementById('step23-content').style.display = 'none';
            document.getElementById('step1-content').style.display = 'block';
            
            // Reset steps
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            
            // Clear country options selection
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Disable continue button
            document.getElementById('continueBtn').disabled = true;
            
            // Set default shipping note
            document.getElementById('shippingText').textContent = 'Ø§Ù„Ø´Ø­Ù† ÙŠØ­Ø¯Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©';
            
            // Reset discount state
            resetDiscount();
        });

        // Select Country
        function selectCountry(country, price) {
            selectedCountry = country;
            selectedPrice = price;
            
            // Update UI
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Enable continue button
            document.getElementById('continueBtn').disabled = false;
            
            // Update steps
            document.getElementById('step1').classList.add('active');
            document.getElementById('step2').classList.add('active');
            
            // Save selection
            localStorage.setItem('selectedCountry', country);
        }

        // Continue to Step 2
        function continueToStep2() {
            if (!selectedCountry) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            // Hide step 1 content and show step 2&3 content
            document.getElementById('step1-content').style.display = 'none';
            document.getElementById('step23-content').style.display = 'block';
            
            // Update step 3 to active
            document.getElementById('step3').classList.add('active');
            
            // Initialize checkout form
            initializeCheckoutForm();
        }

        // Initialize Checkout Form
        function initializeCheckoutForm() {
            // Set selected country in dropdown
            const countrySelect = document.getElementById('countrySelect');
            countrySelect.value = selectedCountry;
            countrySelect.disabled = true; // Disable because already selected
            
            // Load governorates for selected country
            loadGovernorates();
            
            // Update prices in cart
            updateCartPrices();
            
            // Load order summary
            loadOrderSummary();
            
            // Load payment methods
            loadPaymentMethods();
            
            // Setup form submission
            setupFormSubmission();
            
            // Setup address change listeners
            setupAddressListeners();
            
            // Setup discount input listener
            setupDiscountListener();
            
            // Reset discount state
            resetDiscount();
        }

        // Load Governorates
        function loadGovernorates() {
            const governorateSelect = document.getElementById('governorate');
            governorateSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>';
            
            const countryGovernorates = governorates[selectedCountry] || [];
            
            countryGovernorates.forEach(gov => {
                const option = document.createElement('option');
                option.value = gov;
                option.textContent = gov;
                governorateSelect.appendChild(option);
            });
            
            // Add change listener
            governorateSelect.addEventListener('change', function() {
                updateShipping();
            });
        }

        // Update cart prices based on selected country
        function updateCartPrices() {
            cart.forEach(item => {
                item.price = selectedPrice;
            });
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Load Order Summary
        function loadOrderSummary() {
            const orderItems = document.getElementById('orderItems');
            let subtotal = 0;
            let html = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="order-item">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/60'">
                        </div>
                        <div class="item-details">
                            <h5>${item.name}</h5>
                            <p>${item.price} ${getCurrency()} Ã— ${item.quantity}</p>
                        </div>
                        <div class="item-total">
                            ${itemTotal} ${getCurrency()}
                        </div>
                    </div>
                `;
            });
            
            orderItems.innerHTML = html;
            
            // Update totals
            updateTotals(subtotal);
        }

        // Update Totals
        function updateTotals(subtotal) {
            document.getElementById('subtotal').textContent = `${subtotal} ${getCurrency()}`;
            
            // Calculate shipping based on governorate
            const governorate = document.getElementById('governorate').value;
            shippingCost = calculateShippingCost(governorate);
            
            // Apply free shipping if discount code provides it
            let effectiveShippingCost = shippingCost;
            if (isDiscountApplied && appliedDiscountCode && 
                discountCodes[selectedCountry]) {
                const discountInfo = discountCodes[selectedCountry].find(d => d.code === appliedDiscountCode);
                if (discountInfo && discountInfo.freeShipping) {
                    effectiveShippingCost = 0;
                }
            }
            
            document.getElementById('shipping').textContent = `${effectiveShippingCost} ${getCurrency()}`;
            
            // Calculate original total (subtotal + shipping)
            originalTotal = subtotal + shippingCost;
            
            // Calculate final total based on discount status
            if (isDiscountApplied && appliedDiscountCode && discountCodes[selectedCountry]) {
                const discountInfo = discountCodes[selectedCountry].find(d => d.code === appliedDiscountCode);
                
                if (discountInfo) {
                    if (discountInfo.discountType === 'percentage') {
                        // Apply percentage discount only on subtotal (products)
                        discountAmount = subtotal * (discountInfo.discountValue / 100);
                        
                        if (discountInfo.freeShipping) {
                            // Free shipping: only apply discount to subtotal
                            finalTotal = subtotal - discountAmount;
                        } else {
                            // Regular shipping: apply discount to subtotal only
                            finalTotal = (subtotal - discountAmount) + effectiveShippingCost;
                        }
                    }
                    
                    // Update discount row
                    document.getElementById('discountText').textContent = `${discountInfo.description}:`;
                    document.getElementById('discountAmount').textContent = `-${discountAmount} ${getCurrency()}`;
                    document.getElementById('discountRow').style.display = 'flex';
                    
                    // Update discount success message
                    let successMessage = '';
                    if (discountInfo.freeShipping) {
                        successMessage = `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ${discountInfo.description} | ØªÙ… ØªÙˆÙÙŠØ± ${discountAmount} ${getCurrency()} + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ`;
                    } else {
                        successMessage = `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ${discountInfo.description} | ØªÙ… ØªÙˆÙÙŠØ± ${discountAmount} ${getCurrency()}`;
                    }
                    document.getElementById('discountSuccessText').textContent = successMessage;
                    document.getElementById('discountSuccess').classList.add('show');
                }
            } else {
                finalTotal = originalTotal;
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('discountSuccess').classList.remove('show');
            }
            
            // Show/hide original total row
            if (isDiscountApplied) {
                document.getElementById('originalTotal').textContent = `${originalTotal} ${getCurrency()}`;
                document.getElementById('originalTotalRow').style.display = 'flex';
            } else {
                document.getElementById('originalTotalRow').style.display = 'none';
            }
            
            // Update final total display
            document.getElementById('total').textContent = `${finalTotal} ${getCurrency()}`;
            
            // Update shipping note
            updateShippingNote(governorate);
        }

        // Calculate Shipping Cost
        function calculateShippingCost(governorate) {
            if (!governorate || !selectedCountry) return 0;
            
            const countryShipping = shippingPrices[selectedCountry];
            if (!countryShipping) return selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 30 : 60;
            
            // Check for specific governorate
            if (countryShipping[governorate]) {
                return countryShipping[governorate];
            }
            
            // Return default
            return countryShipping.default || (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 30 : 60);
        }

        // Update Shipping Note
        function updateShippingNote(governorate) {
            const shippingText = document.getElementById('shippingText');
            
            if (!governorate) {
                shippingText.textContent = 'Ø§Ù„Ø´Ø­Ù† ÙŠØ­Ø¯Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©';
                return;
            }
            
            const cost = calculateShippingCost(governorate);
            
            if (isDiscountApplied && appliedDiscountCode && discountCodes[selectedCountry]) {
                const discountInfo = discountCodes[selectedCountry].find(d => d.code === appliedDiscountCode);
                
                if (discountInfo && discountInfo.freeShipping) {
                    shippingText.textContent = `âœ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ø¥Ù„Ù‰ ${governorate}`;
                    return;
                }
            }
            
            shippingText.textContent = `ğŸšš Ø§Ù„Ø´Ø­Ù† Ø¥Ù„Ù‰ ${governorate} Ø¨Ù€ ${cost} ${getCurrency()}`;
        }

        // Get Currency Symbol
        function getCurrency() {
            return selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 'Ø±.Ø³' : 'Ø¬.Ù…';
        }

        // Load Payment Methods
        function loadPaymentMethods() {
            const paymentMethodsContainer = document.getElementById('paymentMethods');
            const methods = paymentMethods[selectedCountry] || [];
            
            let html = '';
            methods.forEach(method => {
                html += `
                    <div class="payment-method">
                        <input type="radio" id="${method.id}" name="payment" value="${method.id}" ${method.id === 'cod' ? 'checked' : ''}>
                        <label for="${method.id}">
                            <div class="payment-icon">
                                <i class="${method.icon}"></i>
                            </div>
                            <div class="payment-info">
                                <h4>${method.name}</h4>
                                <p>${method.description}</p>
                            </div>
                        </label>
                    </div>
                `;
            });
            
            paymentMethodsContainer.innerHTML = html;
            
            // Add payment method change listener
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updatePaymentAlert(this.value);
                });
            });
            
            // Initialize payment alert
            updatePaymentAlert('cod');
        }

        // Update Payment Alert
        function updatePaymentAlert(paymentMethod) {
            const paymentAlert = document.getElementById('paymentAlert');
            const paymentAlertText = document.getElementById('paymentAlertText');
            
            const methods = paymentMethods[selectedCountry] || [];
            const selectedMethod = methods.find(m => m.id === paymentMethod);
            
            if (selectedMethod) {
                paymentAlertText.textContent = selectedMethod.alert;
                paymentAlert.classList.add('show');
            } else {
                paymentAlert.classList.remove('show');
            }
        }

        // Setup Address Listeners
        function setupAddressListeners() {
            document.getElementById('city').addEventListener('input', function() {
                updateShipping();
            });
            
            document.getElementById('address').addEventListener('input', function() {
                updateShipping();
            });
        }

        // Setup Discount Listener
        function setupDiscountListener() {
            document.getElementById('discountCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyDiscount();
                }
            });
        }

        // Apply Discount
        function applyDiscount() {
            const discountCode = document.getElementById('discountCode').value.trim().toUpperCase();
            
            if (!discountCode) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…');
                return;
            }
            
            // Check if discount code is valid for selected country
            const countryDiscountCodes = discountCodes[selectedCountry] || [];
            const validDiscount = countryDiscountCodes.find(d => d.code === discountCode);
            
            if (validDiscount) {
                isDiscountApplied = true;
                appliedDiscountCode = discountCode;
                
                // Update UI
                document.getElementById('discountCode').style.borderColor = 'var(--success)';
                document.getElementById('discountCode').style.backgroundColor = 'rgba(74, 222, 128, 0.1)';
                document.getElementById('applyDiscountBtn').innerHTML = 'âœ“ ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                document.getElementById('applyDiscountBtn').disabled = true;
                
                // Recalculate totals with discount
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                updateTotals(subtotal);
                
            } else {
                // Invalid discount code
                document.getElementById('discountCode').style.borderColor = 'var(--danger)';
                document.getElementById('discountCode').style.backgroundColor = 'rgba(247, 37, 133, 0.1)';
                
                // Show error message
                alert(`ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ­ÙŠØ­ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø¯.`);
                
                // Reset discount
                resetDiscount();
            }
        }

        // Reset Discount
        function resetDiscount() {
            isDiscountApplied = false;
            discountAmount = 0;
            appliedDiscountCode = '';
            
            // Reset UI
            document.getElementById('discountCode').value = '';
            document.getElementById('discountCode').style.borderColor = '';
            document.getElementById('discountCode').style.backgroundColor = '';
            document.getElementById('applyDiscountBtn').innerHTML = 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…';
            document.getElementById('applyDiscountBtn').disabled = false;
            
            // Recalculate totals without discount
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
        }

        // Update Shipping
        function updateShipping() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
        }

        // Setup Form Submission
        function setupFormSubmission() {
            document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate form
                if (!validateForm()) {
                    return;
                }
                
                // Disable submit button
                const submitBtn = document.getElementById('submitOrderBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...';
                
                try {
                    // Create order data
                    const orderData = createOrderData();
                    
                    // Save to Firebase with sequential order number
                    const orderNumber = await saveOrderToFirebase(orderData);
                    
                    // Save to localStorage for backup
                    saveOrderToLocalStorage(orderData, orderNumber);
                    
                    // Clear cart
                    localStorage.removeItem('cart');
                    
                    // Show success modal
                    showSuccessModal(orderNumber);
                    
                    // Send WhatsApp notification after 2 seconds
                    setTimeout(() => {
                        sendWhatsAppNotification(orderNumber, orderData);
                    }, 1000);
                    
                    console.log('ğŸŠ Order processed successfully:', orderNumber);

                } catch (error) {
                    console.error('Error saving order:', error);
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù….');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨';
                }
            });
        }

        // Validate Form
        function validateForm() {
            const requiredFields = ['fullName', 'phone', 'email', 'governorate', 'city', 'address'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger)';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            // Validate email format
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                document.getElementById('email').style.borderColor = 'var(--danger)';
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
                isValid = false;
            }
            
            if (!document.getElementById('terms').checked) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…');
                isValid = false;
            }
            
            return isValid;
        }

        // Create Order Data
        function createOrderData() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            
            const orderData = {
                customer: {
                    name: document.getElementById('fullName').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    address: {
                        country: selectedCountry,
                        governorate: document.getElementById('governorate').value,
                        city: document.getElementById('city').value,
                        details: document.getElementById('address').value
                    }
                },
                items: cart,
                payment: {
                    method: paymentMethod,
                    status: 'pending'
                },
                totals: {
                    subtotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    shipping: shippingCost,
                    total: finalTotal,
                    currency: getCurrency()
                },
                discount: {
                    applied: isDiscountApplied,
                    code: appliedDiscountCode,
                    amount: discountAmount,
                    originalTotal: originalTotal,
                    description: isDiscountApplied && appliedDiscountCode ? 
                        (discountCodes[selectedCountry]?.find(d => d.code === appliedDiscountCode)?.description || '') : ''
                },
                status: 'Ø¬Ø¯ÙŠØ¯',
                notes: '',
                createdAt: new Date().toISOString(),
                orderNumber: 0 // This will be updated by saveOrderToFirebase function
            };
            
            return orderData;
        }

        // Save Order to Firebase with Sequential Order Number
        async function saveOrderToFirebase(orderData) {
            try {
                // Get the counter document
                const counterRef = db.collection('counters').doc('orderCounter');
                
                // Use transaction to ensure atomic increment
                const orderNumber = await db.runTransaction(async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    let currentCount = 1;
                    
                    if (counterDoc.exists) {
                        currentCount = counterDoc.data().count + 1;
                    }
                    
                    // Update the counter
                    transaction.set(counterRef, { count: currentCount }, { merge: true });
                    
                    // Create order with sequential number
                    orderData.orderNumber = currentCount;
                    orderData.updatedAt = new Date().toISOString();
                    
                    // Save order with auto-generated ID
                    const orderRef = db.collection('orders').doc();
                    transaction.set(orderRef, orderData);
                    
                    return currentCount;
                });
                
                return orderNumber;
            } catch (error) {
                console.error('Error saving order:', error);
                throw error;
            }
        }

        // Save Order to LocalStorage
        function saveOrderToLocalStorage(orderData, orderNumber) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orderData.id = orderNumber;
            orders.push(orderData);
            localStorage.setItem('orders', JSON.stringify(orders));
        }

        // Show Success Modal
        function showSuccessModal(orderNumber) {
            document.getElementById('orderId').textContent = `#${orderNumber}`;
            document.getElementById('successModal').classList.add('show');
        }

        // Send WhatsApp Notification to Admin
        function sendWhatsAppNotification(orderNumber, orderData) {
            const phone = '966547856086'; // Admin phone number
            
            let paymentText = '';
            let paymentAlert = '';
            
            if (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                if (orderData.payment.method === 'bank-transfer') {
                    paymentText = 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else if (orderData.payment.method === 'stc-pay') {
                    paymentText = 'STC Pay';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… STC Pay Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else {
                    paymentText = 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                    paymentAlert = 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                }
            } else {
                if (orderData.payment.method === 'vodafone-cash') {
                    paymentText = 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else if (orderData.payment.method === 'instapay') {
                    paymentText = 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else {
                    paymentText = 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                    paymentAlert = 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                }
            }
            
            // Add discount information to message
            let discountInfo = '';
            if (orderData.discount.applied) {
                discountInfo = `ğŸ‰ Ø§Ù„Ø®ØµÙ…: ${orderData.discount.description}
ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: ${orderData.discount.originalTotal} ${orderData.totals.currency}
âœ… Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${orderData.totals.total} ${orderData.totals.currency}
ğŸ’² Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…: ${orderData.discount.amount} ${orderData.totals.currency}
`;
            }
            
            const message = `ğŸ‰ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${orderNumber}
ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${orderData.customer.name}
ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${orderData.customer.phone}
ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${orderData.customer.email}
ğŸ“ Ø§Ù„Ø¨Ù„Ø¯: ${orderData.customer.address.country}
ğŸ›ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${orderData.customer.address.governorate}
ğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${orderData.customer.address.city}
ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${orderData.customer.address.details}
${discountInfo}
ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${orderData.totals.total} ${orderData.totals.currency}
ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentText}
ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${orderData.items.length}
${paymentAlert}`;
            
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
        }
    </script>
</body>
</html>