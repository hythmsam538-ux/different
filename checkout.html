<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ - Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Facebook Pixel Code -->
<script>
!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'); fbq('init', '854334524224457'); fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" src="https://www.facebook.com/tr?id=854334524224457&ev=PageView&noscript=1"/></noscript>
<!-- End Facebook Pixel Code -->
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --danger: #f72585;
            --success: #4ade80;
            --warning: #f59e0b;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --radius: 12px;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Cairo', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            padding-top: 90px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
        }

        .logo img {
            height: 60px;
            filter: drop-shadow(0 2px 10px rgba(76, 201, 240, 0.4));
        }

        /* Progress Steps */
        .checkout-progress {
            margin: 30px 0;
        }

        .progress-steps {
            display: flex;
            justify-content: center;
            gap: 40px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 25px;
            right: 0;
            left: 0;
            height: 2px;
            background: var(--gray);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--dark);
            border: 2px solid var(--gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .step.active .step-number {
            background: var(--primary);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(76, 201, 240, 0.4);
        }

        .step-label {
            font-weight: 500;
            color: var(--gray-light);
        }

        .step.active .step-label {
            color: var(--accent);
            font-weight: bold;
        }

        /* Main Content */
        .checkout-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            margin: 40px 0;
        }

        /* Order Summary */
        .order-summary {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 120px;
            height: fit-content;
        }

        .order-summary h3 {
            margin-bottom: 25px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .order-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .order-item {
            display: grid;
            grid-template-columns: 60px 1fr auto;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .item-image img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .item-details h5 {
            margin-bottom: 5px;
        }

        .item-total {
            font-weight: bold;
            color: var(--accent);
        }

        .summary-totals {
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-row.discount {
            color: var(--success);
            font-weight: bold;
        }

        .summary-row.original-total {
            text-decoration: line-through;
            color: var(--gray-light);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .summary-row.final-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--success);
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Shipping Note */
        .shipping-note {
            margin-top: 20px;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .shipping-note i {
            color: #3b82f6;
            margin-left: 5px;
        }

        .shipping-note span {
            font-size: 0.9rem;
            color: #93c5fd;
        }

        /* Discount Success */
        .discount-success {
            margin-top: 20px;
            padding: 15px;
            background: rgba(74, 222, 128, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(74, 222, 128, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .discount-success.show {
            display: block;
        }

        .discount-success i {
            color: var(--success);
            margin-left: 5px;
        }

        .discount-success span {
            font-size: 0.9rem;
            color: #86efac;
        }

        /* Quantity Discount Message */
        .quantity-discount-message {
            margin-top: 15px;
            padding: 15px;
            background: rgba(168, 85, 247, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(168, 85, 247, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .quantity-discount-message.show {
            display: block;
        }

        .quantity-discount-message i {
            color: #a855f7;
            margin-left: 5px;
        }

        .quantity-discount-message span {
            font-size: 0.9rem;
            color: #c084fc;
        }

        /* Checkout Form */
        .checkout-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkout-title {
            margin-bottom: 30px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            margin-bottom: 20px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-light);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius);
            color: var(--light);
            font-size: 1rem;
            transition: var(--transition);
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        .form-group select {
            background: #1e293b !important;
            color: var(--light) !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: left 15px center !important;
            background-size: 12px !important;
            padding-right: 15px !important;
            padding-left: 40px !important;
        }

        .form-group select option {
            background: #1e293b !important;
            color: var(--light) !important;
            padding: 10px !important;
        }

        .form-group select:focus option {
            background: #0f172a !important;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.1);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* City Container */
        .city-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Autocomplete for governorates */
        .autocomplete-container {
            position: relative;
        }

        .autocomplete-list {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            max-height: 200px;
            overflow-y: auto;
            background: var(--dark-light);
            border: 1px solid var(--primary);
            border-radius: var(--radius);
            z-index: 1000;
            margin-top: 5px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .autocomplete-list.show {
            display: block;
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            transition: var(--transition);
        }

        .autocomplete-item:hover {
            background: rgba(76, 201, 240, 0.2);
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-method {
            position: relative;
        }

        .payment-method input {
            position: absolute;
            opacity: 0;
        }

        .payment-method label {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method input:checked + label {
            border-color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
        }

        .payment-method label:hover {
            border-color: var(--accent);
        }

        .payment-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent);
        }

        .payment-info h4 {
            margin-bottom: 5px;
        }

        .payment-info p {
            color: var(--gray-light);
            font-size: 0.9rem;
        }

        /* Discount Input */
        .discount-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .discount-input-container input {
            flex: 1;
        }

        .btn-discount {
            background: var(--success);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
        }

        .btn-discount:hover:not(:disabled) {
            background: #16a34a;
            transform: translateY(-2px);
        }

        .btn-discount:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Payment Alert */
        .payment-alert {
            margin-top: 15px;
            padding: 15px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: var(--radius);
            border: 1px solid rgba(245, 158, 11, 0.3);
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .payment-alert.show {
            display: block;
        }

        .payment-alert i {
            color: var(--warning);
            margin-left: 5px;
        }

        .payment-alert span {
            font-size: 0.9rem;
            color: #fcd34d;
        }

        /* Country Selection */
        .country-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
        }

        .country-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            width: 250px;
            background: rgba(255, 255, 255, 0.05);
        }

        .country-option:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(76, 201, 240, 0.2);
        }

        .country-option.selected {
            border-color: var(--accent);
            background: rgba(76, 201, 240, 0.1);
        }

        .country-flag {
            font-size: 3.5rem;
        }

        .country-name {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .country-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px 30px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 100%;
            margin-top: 20px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--dark-light);
            border-radius: var(--radius);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        /* Footer */
        .footer {
            background: var(--dark);
            padding: 40px 0;
            margin-top: 60px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-bottom {
            text-align: center;
            color: var(--gray);
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Smooth scroll to total price */
        .smooth-scroll {
            scroll-behavior: smooth;
        }

        /* Highlight final total when discount is applied */
        .summary-row.final-total.highlight {
            animation: highlight 2s ease;
            border-color: var(--success);
            background: rgba(74, 222, 128, 0.15);
            padding: 20px;
            border-radius: var(--radius);
            margin-top: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(74, 222, 128, 0.3);
            transform: scale(1.02);
            transition: all 0.3s ease;
        }

        @keyframes highlight {
            0% { 
                transform: scale(1);
                box-shadow: 0 5px 20px rgba(74, 222, 128, 0);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 10px 30px rgba(74, 222, 128, 0.5);
            }
            100% { 
                transform: scale(1.02);
                box-shadow: 0 5px 20px rgba(74, 222, 128, 0.3);
            }
        }

        /* Floating notification for mobile */
        .discount-notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #16a34a);
            color: white;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            z-index: 1001;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideInUp 0.5s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .discount-notification.show {
            display: block;
        }

        .discount-notification-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .discount-notification i {
            font-size: 1.5rem;
        }

        /* Mobile Total Preview */
        .mobile-total-preview {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark-light);
            padding: 15px 20px;
            border-top: 2px solid var(--success);
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        }

        .mobile-total-preview.show {
            display: block;
            animation: slideUpSmall 0.3s ease;
        }

        @keyframes slideUpSmall {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .mobile-total-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-total-label {
            font-size: 0.9rem;
            color: var(--gray-light);
        }

        .mobile-total-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--success);
        }

        .mobile-total-arrow {
            color: var(--accent);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }

        /* Order Summary Loading State */
        .order-summary.loading .summary-row,
        .order-summary.loading .item-total,
        .order-summary.loading .item-details p {
            opacity: 0.3;
        }

        .order-summary.loading .final-total {
            display: none;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .order-summary {
                position: static;
                margin-bottom: 30px;
            }
            
            .city-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .country-options {
                flex-direction: column;
                align-items: center;
            }
            
            .country-option {
                width: 100%;
                max-width: 300px;
            }
            
            body {
                padding-top: 80px;
                padding-bottom: 100px;
            }
            
            .payment-method label {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                padding: 15px;
            }
            
            .payment-info {
                text-align: center;
            }
            
            .discount-input-container {
                flex-direction: column;
            }
            
            .btn-discount {
                width: 100%;
                padding: 12px;
            }

            /* Show mobile total preview on mobile */
            .mobile-total-preview {
                display: block;
            }

            .summary-row.final-total.highlight {
                padding: 15px;
                font-size: 1.2rem;
            }
        }

        @media (max-width: 576px) {
            .checkout-form,
            .order-summary {
                padding: 20px;
            }
            
            .modal-content {
                padding: 20px;
            }

            .discount-notification {
                left: 10px;
                right: 10px;
                bottom: 10px;
            }

            .mobile-total-preview {
                padding: 12px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="logo-removebg-preview.png" alt="Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù">
                </div>
                <a href="cart.html" style="color: var(--light); text-decoration: none;">
                    <i class="fas fa-arrow-right"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ù„Ø©
                </a>
            </div>
        </div>
    </header>

    <!-- Checkout Progress -->
    <div class="checkout-progress">
        <div class="container">
            <div class="progress-steps">
                <div class="step active" id="step1">
                    <div class="step-number">Ù¡</div>
                    <div class="step-label">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">Ù¢</div>
                    <div class="step-label">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">Ù£</div>
                    <div class="step-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Step 1: Country Selection -->
        <div id="step1-content" class="step-content">
            <div style="text-align: center; margin-bottom: 40px;">
                <h1 style="color: var(--accent); margin-bottom: 15px;">
                    <i class="fas fa-globe"></i> Ø§Ø®ØªØ± Ø¨Ù„Ø¯ Ø§Ù„Ø´Ø­Ù†
                </h1>
                <p style="color: var(--gray-light); font-size: 1.1rem;">
                    Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¹Ø± ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù„Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø±
                </p>
            </div>

            <div class="country-options">
                <div class="country-option" onclick="selectCountry('Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 100)">
                    <div class="country-flag">ğŸ‡¸ğŸ‡¦</div>
                    <div class="country-name">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</div>
                    <div class="country-price">100 Ø±.Ø³</div>
                    <small style="color: var(--gray-light);">ÙŠØ´Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</small>
                </div>
                
                <div class="country-option" onclick="selectCountry('Ù…ØµØ±', 320)">
                    <div class="country-flag">ğŸ‡ªğŸ‡¬</div>
                    <div class="country-name">Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ù…ØµØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                    <div class="country-price">320 Ø¬.Ù…</div>
                    <small style="color: var(--gray-light);">ÙŠØ´Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</small>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="btn btn-primary" id="continueBtn" onclick="continueToStep2()" disabled>
                    <i class="fas fa-arrow-left"></i> Ø§Ù„ØªØ§Ù„ÙŠ: Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                </button>
            </div>
        </div>

        <!-- Step 2 & 3: Checkout Form -->
        <div id="step23-content" class="step-content" style="display: none;">
            <div class="checkout-container">
                <!-- Order Summary -->
                <div class="order-summary" id="orderSummaryContainer">
                    <h3><i class="fas fa-shopping-bag"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
                    
                    <div class="order-items" id="orderItems">
                        <!-- Items will be loaded here -->
                    </div>
                    
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                            <span id="subtotal">--</span>
                        </div>
                        <div class="summary-row">
                            <span>Ø§Ù„Ø´Ø­Ù†:</span>
                            <span id="shipping">--</span>
                        </div>
                        
                        <!-- Quantity Discount -->
                        <div class="summary-row discount" id="quantityDiscountRow" style="display: none;">
                            <span id="quantityDiscountText"></span>
                            <span id="quantityDiscountAmount"></span>
                        </div>
                        
                        <!-- Original Total -->
                        <div class="summary-row original-total" id="originalTotalRow" style="display: none;">
                            <span>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ:</span>
                            <span id="originalTotal">--</span>
                        </div>
                        
                        <!-- Discount Applied -->
                        <div class="summary-row discount" id="discountRow" style="display: none;">
                            <span id="discountText"></span>
                            <span id="discountAmount"></span>
                        </div>
                        
                        <!-- Final Total -->
                        <div class="summary-row final-total" id="finalTotalRow">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                            <span id="total">--</span>
                        </div>
                    </div>
                    
                    <div class="shipping-note" id="shippingNote">
                        <i class="fas fa-info-circle"></i>
                        <span id="shippingText">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†</span>
                    </div>
                    
                    <!-- Quantity Discount Message -->
                    <div class="quantity-discount-message" id="quantityDiscountMessage">
                        <i class="fas fa-star"></i>
                        <span id="quantityDiscountMessageText"></span>
                    </div>
                    
                    <!-- Discount Success Message -->
                    <div class="discount-success" id="discountSuccess">
                        <i class="fas fa-gift"></i>
                        <span id="discountSuccessText"></span>
                    </div>
                </div>

                <!-- Checkout Form -->
                <div class="checkout-form">
                    <h1 class="checkout-title">
                        <i class="fas fa-credit-card"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨
                    </h1>

                    <form id="checkoutForm">
                        <!-- Customer Information -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-user"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
                            </h3>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                                    <input type="text" id="fullName" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ *</label>
                                    <input type="tel" id="phone" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *</label>
                                <input type="email" id="email" required>
                                <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 5px;">Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯</small>
                            </div>
                        </div>

                        <!-- Shipping Address -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-map-marker-alt"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†
                            </h3>
                            
                            <div class="form-group">
                                <label for="country">Ø§Ù„Ø¨Ù„Ø¯ *</label>
                                <select id="countrySelect" required>
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯</option>
                                    <option value="Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                                    <option value="Ù…ØµØ±">Ù…ØµØ±</option>
                                </select>
                            </div>
                            
                            <div class="city-container">
                                <div class="form-group autocomplete-container">
                                    <label for="governorateInput">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© *</label>
                                    <input type="text" id="governorateInput" required placeholder="Ø§Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©" autocomplete="off">
                                    <div class="autocomplete-list" id="governorateList"></div>
                                    <input type="hidden" id="governorate" name="governorate">
                                </div>
                                
                                <div class="form-group">
                                    <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ù…Ù†Ø·Ù‚Ø© *</label>
                                    <input type="text" id="city" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ *</label>
                                <textarea id="address" rows="3" required placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯ - Ø§Ù„Ø­ÙŠ - Ø§Ù„Ø´Ø§Ø±Ø¹ - Ø±Ù‚Ù… Ø§Ù„Ù…Ø¨Ù†Ù‰ - Ø§Ù„Ø´Ù‚Ø©"></textarea>
                            </div>
                        </div>

                        <!-- Discount Code -->
                        <div class="form-section" id="discountSection">
                            <h3 class="section-title">
                                <i class="fas fa-tag"></i> ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…
                            </h3>
                            
                            <div class="form-group">
                                <div class="discount-input-container">
                                    <input type="text" id="discountCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…" 
                                           onkeyup="handleDiscountKeyup(event)">
                                    <button type="button" class="btn-discount" id="applyDiscountBtn" onclick="applyDiscount()">
                                        ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…
                                    </button>
                                </div>
                                <small style="color: var(--gray-light); font-size: 0.85rem; display: block; margin-top: 5px;">
                                    <strong>Ù„Ù…ØµØ±:</strong> ÙƒÙˆØ¯ DIFEG10 - Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ<br>
                                    <strong>Ù„Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©:</strong> ÙƒÙˆØ¯ DIFSA10 - Ø®ØµÙ… 50% Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                </small>
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h3 class="section-title">
                                <i class="fas fa-credit-card"></i> Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                            </h3>
                            <div class="payment-methods" id="paymentMethods">
                                <!-- Payment methods will be loaded based on country -->
                            </div>
                            
                            <!-- Payment Alert -->
                            <div class="payment-alert" id="paymentAlert">
                                <i class="fas fa-exclamation-circle"></i>
                                <span id="paymentAlertText"></span>
                            </div>
                        </div>

                        <!-- Terms -->
                        <div class="form-group">
                            <input type="checkbox" id="terms" required style="margin-left: 10px;">
                            <label for="terms">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</label>
                        </div>

                        <button type="submit" class="btn btn-primary" id="submitOrderBtn" disabled>
                            <i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Total Preview -->
    <div class="mobile-total-preview" id="mobileTotalPreview" style="display: none;">
        <div class="mobile-total-content">
            <div>
                <div class="mobile-total-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</div>
                <div class="mobile-total-price" id="mobileTotalPrice">--</div>
            </div>
            <div class="mobile-total-arrow">
                <i class="fas fa-arrow-up"></i>
            </div>
        </div>
    </div>

    <!-- Discount Notification for Mobile -->
    <div class="discount-notification" id="discountNotification">
        <div class="discount-notification-content">
            <i class="fas fa-gift"></i>
            <span id="discountNotificationText">ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø¨Ù†Ø¬Ø§Ø­!</span>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 style="color: var(--success); margin-bottom: 15px;">ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
            <p id="orderDetails" style="margin-bottom: 30px; line-height: 1.6;">
                Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: <strong id="orderId">#</strong><br>
                Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong id="orderDate"></strong><br>
                Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-primary" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© <span id="currentYear">2025</span> | Ù…ÙÙ€Ø®Ù€ØªÙ€Ù„Ù€Ù | Ù‡ÙˆÙŠØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ©</p>
            </div>
        </div>
    </footer>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBEKzQ_S_WRMLWLHk8fLTrIjrN4bvbYb0",
            authDomain: "different-store-admin.firebaseapp.com",
            projectId: "different-store-admin",
            storageBucket: "different-store-admin.firebasestorage.app",
            messagingSenderId: "75347854869d",
            appId: "1:75347854869d:web:044088f5cf63bf3c74c10b"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // Global Variables
        let cart = [];
        let selectedCountry = '';
        let selectedPrice = 0;
        let shippingCost = 0;
        let isDiscountApplied = false;
        let isQuantityDiscountApplied = false;
        let discountAmount = 0;
        let quantityDiscountAmount = 0;
        let originalTotal = 0;
        let finalTotal = 0;
        let appliedDiscountCode = '';
        let isMobile = false;
        
        // Check if mobile
        function checkIfMobile() {
            isMobile = window.innerWidth <= 768;
            return isMobile;
        }
        
        // Valid Discount Codes - Country Specific
        const discountCodes = {
            'Ù…ØµØ±': [
                {
                    code: 'DIFEG10',
                    description: 'Ø®ØµÙ… 20% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ',
                    discountType: 'percentage',
                    discountValue: 20,
                    freeShipping: true
                }
            ],
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                {
                    code: 'DIFSA10',
                    description: 'Ø®ØµÙ… 50% Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
                    discountType: 'percentage',
                    discountValue: 50,
                    freeShipping: false
                }
            ]
        };
        
        // ==== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù„ÙƒÙ„Ø§ Ø§Ù„Ø¨Ù„Ø¯ÙŠÙ† ====
        // Quantity Discount Rules - Ù„ÙƒÙ„ Ø¨Ù„Ø¯
        const quantityDiscountRules = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
                5: { 
                    discountPercent: 50, 
                    freeShipping: true, 
                    description: 'Ø®ØµÙ… 50% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ (Ù„Ù€5 Ù…Ù†ØªØ¬Ø§Øª ÙØ£ÙƒØ«Ø±)' 
                }
            },
            'Ù…ØµØ±': {
                5: { 
                    discountPercent: 40, 
                    freeShipping: true, 
                    description: 'Ø®ØµÙ… 40% + ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ (Ù„Ù€5 Ù…Ù†ØªØ¬Ø§Øª ÙØ£ÙƒØ«Ø±)' 
                }
            }
        };
        
        // Governorates Data Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
        const governorates = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                "Ø§Ù„Ø±ÙŠØ§Ø¶", "Ø¬Ø¯Ø©", "Ù…ÙƒØ©", "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©", "Ø§Ù„Ø¯Ù…Ø§Ù…", "Ø§Ù„Ø®Ø¨Ø±", "Ø§Ù„Ø·Ø§Ø¦Ù", 
                "ØªØ¨ÙˆÙƒ", "Ø£Ø¨Ù‡Ø§", "Ø­Ø§Ø¦Ù„", "Ø§Ù„Ø¨Ø§Ø­Ø©", "Ø§Ù„Ø¬ÙˆÙ", "Ù†Ø¬Ø±Ø§Ù†", "Ø¹Ø±Ø¹Ø±", "Ø³ÙƒØ§ÙƒØ§", 
                "Ø¨Ø±ÙŠØ¯Ø©", "Ø¹Ù†ÙŠØ²Ø©", "Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†", "Ø§Ù„Ø®ÙØ¬ÙŠ", "Ø§Ù„Ù‚Ø·ÙŠÙ", "Ø§Ù„Ù‡ÙÙˆÙ", "Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©"
            ],
            'Ù…ØµØ±': [
                "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©", "Ø§Ù„Ø¬ÙŠØ²Ø©", "Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©", "Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", "Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±", "Ø§Ù„Ø¨Ø­ÙŠØ±Ø©", 
                "Ø§Ù„ÙÙŠÙˆÙ…", "Ø§Ù„ØºØ±Ø¨ÙŠØ©", "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©", "Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©", "Ø§Ù„Ù…Ù†ÙŠØ§", "Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©", 
                "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯", "Ø§Ù„Ø³ÙˆÙŠØ³", "Ø£Ø³ÙˆØ§Ù†", "Ø£Ø³ÙŠÙˆØ·", "Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ", "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", 
                "Ø¯Ù…ÙŠØ§Ø·", "Ø³ÙˆÙ‡Ø§Ø¬", "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡", "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®", "Ù…Ø·Ø±ÙˆØ­", "Ø§Ù„Ø£Ù‚ØµØ±", 
                "Ù‚Ù†Ø§", "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡", "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©"
            ]
        };

        // Payment Methods Configuration
        const paymentMethods = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': [
                {
                    id: 'bank-transfer',
                    name: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ',
                    icon: 'fas fa-university',
                    description: 'Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'stc-pay',
                    name: 'STC Pay',
                    icon: 'fas fa-mobile-alt',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± STC Pay',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… STC Pay Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'cod',
                    name: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
                    icon: 'fas fa-money-bill-wave',
                    description: 'Ø§Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬',
                    alert: '    ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹Ù„Ù… Ø§Ù† Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø³ØªÙ„Ø§Ù… Ø³ØªÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø¯ÙØ¹ Ø¨Ù€ Ù†ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆÙ‡Ø°Ø§ Ù„Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ ÙŠØµÙ…Ù… Ø®ØµÙŠØµØ§ Ù„Ùƒ ÙˆØ¨Ø£Ø³Ù…Ùƒ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨   '
                }
            ],
            'Ù…ØµØ±': [
                {
                    id: 'vodafone-cash',
                    name: 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                    icon: 'fas fa-mobile-alt',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'instapay',
                    name: 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                    icon: 'fas fa-credit-card',
                    description: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ',
                    alert: 'Ø¨Ø¹Ø¯ Ø§ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ Ø³Ù†Ø±Ø³Ù„Ùƒ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹'
                },
                {
                    id: 'cod',
                    name: 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…',
                    icon: 'fas fa-money-bill-wave',
                    description: 'Ø§Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…Ù†ØªØ¬',
                    alert: '   ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¹Ù„Ù… Ø§Ù† Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø£Ø³ØªÙ„Ø§Ù… Ø³ØªÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø¯ÙØ¹ Ø¨Ù€ Ù†ØµÙ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆÙ‡Ø°Ø§ Ù„Ø£Ù† Ø§Ù„Ø·Ù„Ø¨ ÙŠØµÙ…Ù… Ø®ØµÙŠØµØ§ Ù„Ùƒ ÙˆØ¨Ø£Ø³Ù…Ùƒ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨    '
                }
            ]
        };

        // Shipping Costs Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
        const shippingPrices = {
            'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©': {
                'Ø§Ù„Ø±ÙŠØ§Ø¶': 25,
                'Ø¬Ø¯Ø©': 25,
                'Ù…ÙƒØ©': 25,
                'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': 25,
                'Ø§Ù„Ø¯Ù…Ø§Ù…': 25,
                'Ø§Ù„Ø®Ø¨Ø±': 25,
                'Ø§Ù„Ø·Ø§Ø¦Ù': 25,
                'ØªØ¨ÙˆÙƒ': 25,
                'Ø£Ø¨Ù‡Ø§': 25,
                'Ø­Ø§Ø¦Ù„': 25,
                'Ø§Ù„Ø¨Ø§Ø­Ø©': 25,
                'Ø§Ù„Ø¬ÙˆÙ': 25,
                'Ù†Ø¬Ø±Ø§Ù†': 25,
                'Ø¹Ø±Ø¹Ø±': 25,
                'Ø³ÙƒØ§ÙƒØ§': 25,
                'Ø¨Ø±ÙŠØ¯Ø©': 25,
                'Ø¹Ù†ÙŠØ²Ø©': 25,
                'Ø­ÙØ± Ø§Ù„Ø¨Ø§Ø·Ù†': 10,
                'Ø§Ù„Ø®ÙØ¬ÙŠ': 25,
                'Ø§Ù„Ù‚Ø·ÙŠÙ': 25,
                'Ø§Ù„Ù‡ÙÙˆÙ': 25,
                'Ø§Ù„Ù…Ø¬Ù…Ø¹Ø©': 25,
                'default': 25
            },
            'Ù…ØµØ±': {
                'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©': 55,
                'Ø§Ù„Ø¬ÙŠØ²Ø©': 55,
                'Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©': 80,
                'Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©': 70,
                'Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±': 80,
                'Ø§Ù„Ø¨Ø­ÙŠØ±Ø©': 80,
                'Ø§Ù„ÙÙŠÙˆÙ…': 55,
                'Ø§Ù„ØºØ±Ø¨ÙŠØ©': 70,
                'Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©': 70,
                'Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©': 70,
                'Ø§Ù„Ù…Ù†ÙŠØ§': 50,
                'Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©': 55,
                'Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯': 95,
                'Ø§Ù„Ø³ÙˆÙŠØ³': 70,
                'Ø£Ø³ÙˆØ§Ù†': 95,
                'Ø£Ø³ÙŠÙˆØ·': 55,
                'Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ': 55,
                'Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯': 80,
                'Ø¯Ù…ÙŠØ§Ø·': 80,
                'Ø³ÙˆÙ‡Ø§Ø¬': 55,
                'Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡': 95,
                'ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®': 80,
                'Ù…Ø·Ø±ÙˆØ­': 95,
                'Ø§Ù„Ø£Ù‚ØµØ±': 80,
                'Ù‚Ù†Ø§': 70,
                'Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡': 85,
                'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©': 70,
                'default': 70
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check if mobile
            checkIfMobile();
            window.addEventListener('resize', checkIfMobile);
            
            // Load cart from localStorage with validation
            try {
                const cartData = localStorage.getItem('cart');
                cart = cartData ? JSON.parse(cartData) : [];
                
                // Validate cart data
                if (!Array.isArray(cart)) {
                    cart = [];
                }
                
                // Filter invalid items
                cart = cart.filter(item => item && item.id && item.name && item.price);
                
                // If cart is empty, redirect to cart page
                if (cart.length === 0) {
                    window.location.href = 'cart.html';
                    return;
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¨Ø©:', error);
                cart = [];
                window.location.href = 'cart.html';
                return;
            }
            
            // Reset all calculation variables
            selectedCountry = '';
            selectedPrice = 0;
            shippingCost = 0;
            isDiscountApplied = false;
            isQuantityDiscountApplied = false;
            discountAmount = 0;
            quantityDiscountAmount = 0;
            originalTotal = 0;
            finalTotal = 0;
            appliedDiscountCode = '';
            
            // Set current year
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            
            // Start from step 1 - country selection
            localStorage.removeItem('selectedCountry');
            
            // Hide checkout form, show country selection
            document.getElementById('step23-content').style.display = 'none';
            document.getElementById('step1-content').style.display = 'block';
            
            // Reset steps
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step3').classList.remove('active');
            document.getElementById('step1').classList.add('active');
            
            // Clear country options selection
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Disable continue button
            document.getElementById('continueBtn').disabled = true;
            
            // Set default shipping note
            document.getElementById('shippingText').textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†';
            
            // Reset all totals to --
            document.getElementById('subtotal').textContent = '--';
            document.getElementById('shipping').textContent = '--';
            document.getElementById('total').textContent = '--';
            document.getElementById('mobileTotalPrice').textContent = '--';
            
            // Hide discount and original total rows
            document.getElementById('originalTotalRow').style.display = 'none';
            document.getElementById('discountRow').style.display = 'none';
            document.getElementById('quantityDiscountRow').style.display = 'none';
            
            // Add loading class to order summary
            document.getElementById('orderSummaryContainer').classList.add('loading');
        });

        // ===================== DISCOUNT CODE HANDLING =====================
        // Handle discount input keyup
        function handleDiscountKeyup(event) {
            const discountCode = document.getElementById('discountCode').value;
            
            if (discountCode) {
                document.getElementById('discountCode').value = discountCode.toUpperCase();
            }
            
            if (event.key === 'Enter') {
                event.preventDefault();
                applyDiscount();
            }
        }

        // Apply Discount
        function applyDiscount() {
            if (!selectedCountry || selectedPrice <= 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            const discountCode = document.getElementById('discountCode').value.trim().toUpperCase();
            
            if (!discountCode) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… Ø£ÙˆÙ„Ø§Ù‹');
                document.getElementById('discountCode').focus();
                return;
            }
            
            // Check if discount code is valid for selected country
            const countryDiscountCodes = discountCodes[selectedCountry] || [];
            const validDiscount = countryDiscountCodes.find(d => d.code === discountCode);
            
            if (validDiscount) {
                isDiscountApplied = true;
                isQuantityDiscountApplied = false; // Cancel quantity discount
                appliedDiscountCode = discountCode;
                
                // Update UI
                document.getElementById('discountCode').style.borderColor = 'var(--success)';
                document.getElementById('discountCode').style.backgroundColor = 'rgba(74, 222, 128, 0.1)';
                document.getElementById('applyDiscountBtn').innerHTML = '<i class="fas fa-check"></i> ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚';
                document.getElementById('applyDiscountBtn').disabled = true;
                
                // Recalculate totals with discount
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                updateTotals(subtotal);
                
                // Show success message
                showToast(`âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙƒÙˆØ¯ ${discountCode} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                
            } else {
                // Invalid discount code
                document.getElementById('discountCode').style.borderColor = 'var(--danger)';
                document.getElementById('discountCode').style.backgroundColor = 'rgba(247, 37, 133, 0.1)';
                
                // Show error message
                showToast('âŒ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… ØºÙŠØ± ØµØ­ÙŠØ­ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù„Ø¯', 'error');
                
                // Reset discount
                resetDiscount();
            }
        }

        // Reset Discount
        function resetDiscount() {
            isDiscountApplied = false;
            isQuantityDiscountApplied = false;
            discountAmount = 0;
            quantityDiscountAmount = 0;
            appliedDiscountCode = '';
            
            // Reset UI
            document.getElementById('discountCode').value = '';
            document.getElementById('discountCode').style.borderColor = '';
            document.getElementById('discountCode').style.backgroundColor = '';
            document.getElementById('applyDiscountBtn').innerHTML = 'ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ…';
            document.getElementById('applyDiscountBtn').disabled = false;
            
            // Recalculate totals without discount
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
        }

        // Select Country
        function selectCountry(country, price) {
            selectedCountry = country;
            selectedPrice = price;
            
            // Update UI
            document.querySelectorAll('.country-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Enable continue button
            document.getElementById('continueBtn').disabled = false;
            
            // Update steps
            document.getElementById('step1').classList.add('active');
            document.getElementById('step2').classList.add('active');
            
            // Save selection
            localStorage.setItem('selectedCountry', country);
            
            // Show temporary prices as 0
            const orderItems = document.getElementById('orderItems');
            let html = '';
            
            cart.forEach(item => {
                html += `
                    <div class="order-item">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/60'">
                        </div>
                        <div class="item-details">
                            <h5>${item.name}</h5>
                            <p>Ù  ${getCurrency()} Ã— ${item.quantity}</p>
                        </div>
                        <div class="item-total">
                            Ù  ${getCurrency()}
                        </div>
                    </div>
                `;
            });
            
            orderItems.innerHTML = html;
            
            // Show prices as 0 temporarily
            document.getElementById('subtotal').textContent = `Ù  ${getCurrency()}`;
            document.getElementById('shipping').textContent = `Ù  ${getCurrency()}`;
            document.getElementById('total').textContent = `Ù  ${getCurrency()}`;
            document.getElementById('mobileTotalPrice').textContent = `Ù  ${getCurrency()}`;
            
            // Hide discount and original total
            document.getElementById('originalTotalRow').style.display = 'none';
            document.getElementById('discountRow').style.display = 'none';
            document.getElementById('quantityDiscountRow').style.display = 'none';
            
            // Update shipping note
            document.getElementById('shippingText').textContent = `Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù† Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©`;
        }

        // Continue to Step 2
        function continueToStep2() {
            if (!selectedCountry) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            // Hide step 1 content and show step 2&3 content
            document.getElementById('step1-content').style.display = 'none';
            document.getElementById('step23-content').style.display = 'block';
            
            // Update step 3 to active
            document.getElementById('step3').classList.add('active');
            
            // Remove loading class
            document.getElementById('orderSummaryContainer').classList.remove('loading');
            
            // Initialize checkout form
            initializeCheckoutForm();
        }

        // Initialize Checkout Form
        function initializeCheckoutForm() {
            // Set selected country in dropdown
            const countrySelect = document.getElementById('countrySelect');
            countrySelect.value = selectedCountry;
            countrySelect.disabled = true;
            
            // Initialize autocomplete for governorates
            initGovernorateAutocomplete();
            
            // Update prices in cart
            updateCartPrices();
            
            // Load order summary
            loadOrderSummary();
            
            // Load payment methods
            loadPaymentMethods();
            
            // Setup form submission
            setupFormSubmission();
            
            // Setup address change listeners
            setupAddressListeners();
            
            // Setup discount input listener
            setupDiscountListener();
            
            // Reset discount state
            resetDiscount();
            
            // Update mobile total preview
            updateMobileTotalPreview();
            
            // Enable/Disable submit button based on total
            document.getElementById('submitOrderBtn').disabled = finalTotal <= 0;
        }

        // Initialize Governorates Autocomplete
        function initGovernorateAutocomplete() {
            const input = document.getElementById('governorateInput');
            const list = document.getElementById('governorateList');
            const hiddenInput = document.getElementById('governorate');
            
            // Populate autocomplete list
            function populateAutocomplete(searchTerm = '') {
                const countryGovernorates = governorates[selectedCountry] || [];
                let filteredGovernorates = countryGovernorates;
                
                if (searchTerm) {
                    filteredGovernorates = countryGovernorates.filter(gov => 
                        gov.includes(searchTerm)
                    );
                }
                
                // Sort by search term
                filteredGovernorates.sort((a, b) => {
                    const aStartsWith = a.startsWith(searchTerm);
                    const bStartsWith = b.startsWith(searchTerm);
                    if (aStartsWith && !bStartsWith) return -1;
                    if (!aStartsWith && bStartsWith) return 1;
                    return a.localeCompare(b);
                });
                
                list.innerHTML = '';
                
                if (filteredGovernorates.length === 0) {
                    const item = document.createElement('div');
                    item.className = 'autocomplete-item';
                    item.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬';
                    item.style.color = 'var(--gray-light)';
                    item.style.cursor = 'default';
                    list.appendChild(item);
                } else {
                    filteredGovernorates.forEach(gov => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        item.textContent = gov;
                        item.addEventListener('click', function() {
                            input.value = gov;
                            hiddenInput.value = gov;
                            list.classList.remove('show');
                            
                            // ==== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ====
                            applyQuantityDiscountAndUpdate();
                        });
                        list.appendChild(item);
                    });
                }
            }
            
            // Input event listener
            input.addEventListener('input', function() {
                const value = this.value.trim();
                hiddenInput.value = value;
                
                if (value) {
                    populateAutocomplete(value);
                    list.classList.add('show');
                } else {
                    list.classList.remove('show');
                    hiddenInput.value = '';
                }
                
                // ==== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø£ÙŠØ¶Ø§Ù‹ ====
                applyQuantityDiscountAndUpdate();
            });
            
            // Focus event listener
            input.addEventListener('focus', function() {
                if (this.value.trim()) {
                    populateAutocomplete(this.value.trim());
                    list.classList.add('show');
                } else {
                    populateAutocomplete();
                    list.classList.add('show');
                }
            });
            
            // Click outside to close
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.autocomplete-container')) {
                    list.classList.remove('show');
                }
            });
            
            // Keyboard navigation
            input.addEventListener('keydown', function(event) {
                const items = list.querySelectorAll('.autocomplete-item');
                let currentIndex = -1;
                
                items.forEach((item, index) => {
                    if (item.style.backgroundColor) {
                        currentIndex = index;
                    }
                });
                
                if (event.key === 'ArrowDown') {
                    event.preventDefault();
                    if (currentIndex < items.length - 1) {
                        items.forEach(item => item.style.backgroundColor = '');
                        items[currentIndex + 1].style.backgroundColor = 'rgba(76, 201, 240, 0.2)';
                        items[currentIndex + 1].scrollIntoView({ block: 'nearest' });
                    }
                } else if (event.key === 'ArrowUp') {
                    event.preventDefault();
                    if (currentIndex > 0) {
                        items.forEach(item => item.style.backgroundColor = '');
                        items[currentIndex - 1].style.backgroundColor = 'rgba(76, 201, 240, 0.2)';
                        items[currentIndex - 1].scrollIntoView({ block: 'nearest' });
                    }
                } else if (event.key === 'Enter') {
                    event.preventDefault();
                    const selectedItem = list.querySelector('.autocomplete-item[style*="background-color"]');
                    if (selectedItem && selectedItem.textContent !== 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬') {
                        input.value = selectedItem.textContent;
                        hiddenInput.value = selectedItem.textContent;
                        list.classList.remove('show');
                        
                        // ==== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± ====
                        applyQuantityDiscountAndUpdate();
                    }
                }
            });
            
            // Initialize with empty list
            populateAutocomplete();
        }

        // ==== Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ====
        function applyQuantityDiscountAndUpdate() {
            // ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹
            applyQuantityDiscount();
            
            // Ø«Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
        }

        // Update cart prices based on selected country
        function updateCartPrices() {
            if (!selectedCountry || selectedPrice <= 0) {
                console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: Ø§Ù„Ø¨Ù„Ø¯ Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø± ØºÙŠØ± Ù…Ø­Ø¯Ø¯');
                return;
            }
            
            cart.forEach(item => {
                item.price = selectedPrice;
            });
            localStorage.setItem('cart', JSON.stringify(cart));
            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¥Ù„Ù‰:', selectedPrice, getCurrency());
        }

        // Load Order Summary
        function loadOrderSummary() {
            const orderItems = document.getElementById('orderItems');
            let subtotal = 0;
            let html = '';
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="order-item">
                        <div class="item-image">
                            <img src="${item.image}" alt="${item.name}" onerror="this.src='https://via.placeholder.com/60'">
                        </div>
                        <div class="item-details">
                            <h5>${item.name}</h5>
                            <p>${item.price} ${getCurrency()} Ã— ${item.quantity}</p>
                        </div>
                        <div class="item-total">
                            ${itemTotal} ${getCurrency()}
                        </div>
                    </div>
                `;
            });
            
            orderItems.innerHTML = html;
            
            // Update totals
            updateTotals(subtotal);
        }

        // ==== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ====
        function applyQuantityDiscount() {
            // Ù„Ø§ ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®ØµÙ… ÙƒÙˆØ¯
            if (isDiscountApplied) {
                console.log('Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ØªÙ… Ø¥Ù„ØºØ§Ø¤Ù‡ Ø¨Ø³Ø¨Ø¨ Ø®ØµÙ… Ø§Ù„ÙƒÙˆØ¯');
                isQuantityDiscountApplied = false;
                document.getElementById('quantityDiscountMessage').classList.remove('show');
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨Ù„Ø¯ Ù…Ø­Ø¯Ø¯ ÙˆÙ…Ø­Ø§ÙØ¸Ø©
            const governorate = document.getElementById('governorate').value;
            if (!selectedCountry || !governorate) {
                console.log('Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ©: ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¨Ù„Ø¯ ÙˆÙ…Ø­Ø§ÙØ¸Ø© Ø£ÙˆÙ„Ø§Ù‹');
                isQuantityDiscountApplied = false;
                document.getElementById('quantityDiscountMessage').classList.remove('show');
                return;
            }
            
            // Calculate total quantity
            const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
            console.log(`Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©: ${totalQuantity} Ù…Ù†ØªØ¬`);
            
            // Find applicable rule for selected country
            let applicableRule = null;
            const countryRules = quantityDiscountRules[selectedCountry] || {};
            
            if (totalQuantity >= 5) {
                applicableRule = countryRules[5];
                console.log(`Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…ØªØ§Ø­: ${applicableRule ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}`);
            }
            
            if (applicableRule) {
                isQuantityDiscountApplied = true;
                
                // Show quantity discount message
                const message = document.getElementById('quantityDiscountMessageText');
                message.textContent = `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! ${applicableRule.description}`;
                document.getElementById('quantityDiscountMessage').classList.add('show');
                
                console.log(`ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ©: ${applicableRule.description}`);
                
            } else {
                isQuantityDiscountApplied = false;
                document.getElementById('quantityDiscountMessage').classList.remove('show');
                console.log('Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­ Ø£Ùˆ Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙŠÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙˆØ·');
            }
        }

        // Update Totals with "ØªÙ… ØªÙˆÙÙŠØ±" message
        function updateTotals(subtotal) {
            console.log('ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª...');
            console.log(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ: ${subtotal}`);
            console.log(`Ø®ØµÙ… Ø§Ù„ÙƒÙˆØ¯ Ù…Ø·Ø¨Ù‚: ${isDiscountApplied}`);
            console.log(`Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ø·Ø¨Ù‚: ${isQuantityDiscountApplied}`);
            
            document.getElementById('subtotal').textContent = `${subtotal} ${getCurrency()}`;
            
            // Calculate shipping based on governorate
            const governorate = document.getElementById('governorate').value;
            shippingCost = calculateShippingCost(governorate);
            console.log(`ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù†: ${shippingCost}`);
            
            // Apply free shipping based on discount or quantity discount
            let effectiveShippingCost = shippingCost;
            let discountDescription = '';
            let discountValue = 0;
            let freeShippingApplied = false;
            
            if (isDiscountApplied && appliedDiscountCode && discountCodes[selectedCountry]) {
                const discountInfo = discountCodes[selectedCountry].find(d => d.code === appliedDiscountCode);
                if (discountInfo) {
                    discountDescription = discountInfo.description;
                    if (discountInfo.freeShipping) {
                        effectiveShippingCost = 0;
                        freeShippingApplied = true;
                    }
                    if (discountInfo.discountType === 'percentage') {
                        discountValue = discountInfo.discountValue;
                    }
                }
                console.log(`Ø®ØµÙ… Ø§Ù„ÙƒÙˆØ¯: ${discountDescription}, Ø§Ù„Ù‚ÙŠÙ…Ø©: ${discountValue}%, Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ: ${freeShippingApplied}`);
            } else if (isQuantityDiscountApplied) {
                // Apply quantity discount for both countries
                const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
                const countryRules = quantityDiscountRules[selectedCountry] || {};
                let applicableRule = null;
                
                if (totalQuantity >= 5) {
                    applicableRule = countryRules[5];
                }
                
                if (applicableRule) {
                    discountDescription = applicableRule.description;
                    discountValue = applicableRule.discountPercent;
                    if (applicableRule.freeShipping) {
                        effectiveShippingCost = 0;
                        freeShippingApplied = true;
                    }
                }
                console.log(`Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ©: ${discountDescription}, Ø§Ù„Ù‚ÙŠÙ…Ø©: ${discountValue}%, Ø´Ø­Ù† Ù…Ø¬Ø§Ù†ÙŠ: ${freeShippingApplied}`);
            }
            
            document.getElementById('shipping').textContent = `${effectiveShippingCost} ${getCurrency()}`;
            
            // Calculate original total (subtotal + shipping)
            originalTotal = subtotal + shippingCost;
            console.log(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ØµÙ„ÙŠ: ${originalTotal}`);
            
            // Calculate discounts
            discountAmount = 0;
            quantityDiscountAmount = 0;
            
            if (isDiscountApplied && discountValue > 0) {
                discountAmount = subtotal * (discountValue / 100);
                finalTotal = (subtotal - discountAmount) + effectiveShippingCost;
                
                // Update discount row
                document.getElementById('discountText').textContent = `${discountDescription}:`;
                document.getElementById('discountAmount').textContent = `-${discountAmount} ${getCurrency()}`;
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('quantityDiscountRow').style.display = 'none';
                
                // Update discount success message with "ØªÙ… ØªÙˆÙÙŠØ±"
                let savedAmount = discountAmount;
                if (freeShippingApplied) {
                    savedAmount += shippingCost;
                }
                
                let savedMessage = '';
                if (selectedCountry === 'Ù…ØµØ±') {
                    savedMessage = `ğŸ‰ ${discountDescription} | ØªÙ… ØªÙˆÙÙŠØ± ${savedAmount} Ø¬Ù†ÙŠÙ‡`;
                } else if (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                    savedMessage = `ğŸ‰ ${discountDescription} | ØªÙ… ØªÙˆÙÙŠØ± ${savedAmount} Ø±ÙŠØ§Ù„`;
                }
                
                document.getElementById('discountSuccessText').textContent = savedMessage;
                document.getElementById('discountSuccess').classList.add('show');
                
            } else if (isQuantityDiscountApplied && discountValue > 0) {
                quantityDiscountAmount = subtotal * (discountValue / 100);
                finalTotal = (subtotal - quantityDiscountAmount) + effectiveShippingCost;
                
                // Update quantity discount row
                document.getElementById('quantityDiscountText').textContent = `${discountDescription}:`;
                document.getElementById('quantityDiscountAmount').textContent = `-${quantityDiscountAmount} ${getCurrency()}`;
                document.getElementById('quantityDiscountRow').style.display = 'flex';
                document.getElementById('discountRow').style.display = 'none';
                
                // Update quantity discount message with "ØªÙ… ØªÙˆÙÙŠØ±"
                let savedAmount = quantityDiscountAmount;
                if (freeShippingApplied) {
                    savedAmount += shippingCost;
                }
                
                let savedMessage = '';
                if (selectedCountry === 'Ù…ØµØ±') {
                    savedMessage = `ğŸ‰ ${discountDescription} | ØªÙ… ØªÙˆÙÙŠØ± ${savedAmount} Ø¬Ù†ÙŠÙ‡`;
                } else if (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                    savedMessage = `ğŸ‰ ${discountDescription} | ØªÙ… ØªÙˆÙÙŠØ± ${savedAmount} Ø±ÙŠØ§Ù„`;
                }
                
                document.getElementById('quantityDiscountMessageText').textContent = savedMessage;
                
                // Hide code discount message
                document.getElementById('discountSuccess').classList.remove('show');
            } else {
                finalTotal = originalTotal;
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('quantityDiscountRow').style.display = 'none';
                document.getElementById('discountSuccess').classList.remove('show');
            }
            
            // Update UI immediately
            document.getElementById('originalTotal').textContent = `${originalTotal} ${getCurrency()}`;
            if (isDiscountApplied || isQuantityDiscountApplied) {
                document.getElementById('originalTotalRow').style.display = 'flex';
            } else {
                document.getElementById('originalTotalRow').style.display = 'none';
            }
            
            document.getElementById('total').textContent = `${finalTotal} ${getCurrency()}`;
            console.log(`Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${finalTotal}`);
            
            // Highlight final total if discount applied
            if (isDiscountApplied || isQuantityDiscountApplied) {
                const finalTotalRow = document.getElementById('finalTotalRow');
                finalTotalRow.classList.add('highlight');
                
                // Remove highlight after animation
                setTimeout(() => {
                    finalTotalRow.classList.remove('highlight');
                }, 2000);
                
                // Show mobile notification
                let notificationMessage = '';
                if (isDiscountApplied) {
                    notificationMessage = `ğŸ‰ ${discountDescription} ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§!`;
                } else {
                    notificationMessage = `ğŸ‰ ${discountDescription}`;
                }
                showMobileDiscountNotification(notificationMessage);
                
                // Scroll to show the total (mobile friendly)
                scrollToTotal();
            }
            
            // Update shipping note
            updateShippingNote(governorate, freeShippingApplied);
            
            // Update mobile total preview
            updateMobileTotalPreview();
            
            // Enable/Disable submit button based on total
            document.getElementById('submitOrderBtn').disabled = finalTotal <= 0;
            console.log(`Ø²Ø± Ø§Ù„ØªØ£ÙƒÙŠØ¯: ${finalTotal <= 0 ? 'Ù…Ø¹Ø·Ù„' : 'Ù…ÙØ¹Ù„'}`);
        }

        // Show Mobile Discount Notification
        function showMobileDiscountNotification(message) {
            if (!isMobile) return;
            
            const notification = document.getElementById('discountNotification');
            const notificationText = document.getElementById('discountNotificationText');
            
            notificationText.textContent = message;
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Scroll to Total - Mobile friendly
        function scrollToTotal() {
            const finalTotalRow = document.getElementById('finalTotalRow');
            
            if (isMobile) {
                // On mobile, show the mobile total preview and scroll gently
                finalTotalRow.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // Also show mobile preview
                document.getElementById('mobileTotalPreview').classList.add('show');
            } else {
                // On desktop, scroll to the total section
                finalTotalRow.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
        }

        // Update Mobile Total Preview
        function updateMobileTotalPreview() {
            const mobileTotalPrice = document.getElementById('mobileTotalPrice');
            
            if (finalTotal <= 0) {
                mobileTotalPrice.textContent = '--';
                document.getElementById('mobileTotalPreview').style.display = 'none';
            } else {
                // Update currency in mobile preview
                const currency = getCurrency();
                mobileTotalPrice.textContent = `${finalTotal} ${currency}`;
                document.getElementById('mobileTotalPreview').style.display = 'block';
            }
        }

        // Calculate Shipping Cost
        function calculateShippingCost(governorate) {
            if (!governorate || !selectedCountry) return 0;
            
            const countryShipping = shippingPrices[selectedCountry];
            if (!countryShipping) return selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 70 : 70;
            
            // Check for specific governorate
            if (countryShipping[governorate]) {
                return countryShipping[governorate];
            }
            
            // Return default
            return countryShipping.default || (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 70 : 70);
        }

        // Update Shipping Note
        function updateShippingNote(governorate, freeShippingApplied = false) {
            const shippingText = document.getElementById('shippingText');
            
            if (!selectedCountry || selectedPrice <= 0) {
                shippingText.textContent = 'Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†';
                return;
            }
            
            if (!governorate) {
                shippingText.textContent = `Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ø§Ù„Ø´Ø­Ù†`;
                return;
            }
            
            const cost = calculateShippingCost(governorate);
            
            if (freeShippingApplied) {
                shippingText.textContent = `âœ… Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¬Ø§Ù†ÙŠ Ø¥Ù„Ù‰ ${governorate}`;
                return;
            }
            
            shippingText.textContent = `ğŸšš Ø§Ù„Ø´Ø­Ù† Ø¥Ù„Ù‰ ${governorate} Ø¨Ù€ ${cost} ${getCurrency()}`;
        }

        // Get Currency Symbol
        function getCurrency() {
            if (!selectedCountry) {
                return '--';
            }
            return selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©' ? 'Ø±.Ø³' : 'Ø¬.Ù…';
        }

        // Load Payment Methods
        function loadPaymentMethods() {
            const paymentMethodsContainer = document.getElementById('paymentMethods');
            const methods = paymentMethods[selectedCountry] || [];
            
            let html = '';
            methods.forEach(method => {
                html += `
                    <div class="payment-method">
                        <input type="radio" id="${method.id}" name="payment" value="${method.id}" ${method.id === 'cod' ? 'checked' : ''}>
                        <label for="${method.id}">
                            <div class="payment-icon">
                                <i class="${method.icon}"></i>
                            </div>
                            <div class="payment-info">
                                <h4>${method.name}</h4>
                                <p>${method.description}</p>
                            </div>
                        </label>
                    </div>
                `;
            });
            
            paymentMethodsContainer.innerHTML = html;
            
            // Add payment method change listener
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updatePaymentAlert(this.value);
                });
            });
            
            // Initialize payment alert
            updatePaymentAlert('cod');
        }

        // Update Payment Alert
        function updatePaymentAlert(paymentMethod) {
            const paymentAlert = document.getElementById('paymentAlert');
            const paymentAlertText = document.getElementById('paymentAlertText');
            
            const methods = paymentMethods[selectedCountry] || [];
            const selectedMethod = methods.find(m => m.id === paymentMethod);
            
            if (selectedMethod) {
                paymentAlertText.textContent = selectedMethod.alert;
                paymentAlert.classList.add('show');
            } else {
                paymentAlert.classList.remove('show');
            }
        }

        // Setup Address Listeners
        function setupAddressListeners() {
            document.getElementById('city').addEventListener('input', function() {
                updateShipping();
            });
            
            document.getElementById('address').addEventListener('input', function() {
                updateShipping();
            });
        }

        // Setup Discount Listener
        function setupDiscountListener() {
            document.getElementById('discountCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyDiscount();
                }
            });
        }

        // Update Shipping
        function updateShipping() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            updateTotals(subtotal);
        }

        // ===================== ORDER PROCESSING =====================
        // Setup Form Submission
        function setupFormSubmission() {
            document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate form
                if (!validateForm()) {
                    return;
                }
                
                // Disable submit button
                const submitBtn = document.getElementById('submitOrderBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...';
                
                console.log('ğŸš€ Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨...');
                
                try {
                    // Create order data
                    const orderData = createOrderData();
                    console.log('ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù…Ø­Ø¶Ø±Ø©:', orderData);
                    
                    // === Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase ===
                    console.log('ğŸ”¥ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase...');
                    const orderNumber = await saveOrderToFirebase(orderData);
                    console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase - Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:', orderNumber);
                    
                    // Save to localStorage for backup
                    saveOrderToLocalStorage(orderData, orderNumber);
                    console.log('ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ localStorage');
                    
                    // Clear cart
                    localStorage.removeItem('cart');
                    
                    // Show success modal
                    showSuccessModal(orderNumber);
                    
                    // Send WhatsApp notification
                    console.log('ğŸ“± Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨...');
                    setTimeout(() => {
                        sendWhatsAppNotification(orderNumber, orderData);
                    }, 1000);
                    // ===================== FACEBOOK PURCHASE TRACKING =====================
console.log('ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¯Ø« Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¥Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ...');
try {
    // Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¯Ø« Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¥Ù„Ù‰ Ø¨ÙƒØ³Ù„ ÙÙŠØ³Ø¨ÙˆÙƒ
    fbq('track', 'Purchase', {
        value: finalTotal, // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø·Ù„Ø¨
        currency: selectedCountry === 'Ù…ØµØ±' ? 'EGP' : 'SAR', // Ø§Ù„Ø¹Ù…Ù„Ø©
        contents: cart.map(item => ({
            id: item.id || 'product_' + item.name,
            quantity: item.quantity || 1,
            item_price: item.price || selectedPrice
        })),
        content_type: 'product',
        order_id: orderNumber.toString() // Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨
    });
    console.log('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¯Ø« Purchase Ø¥Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ:', {
        value: finalTotal,
        currency: selectedCountry === 'Ù…ØµØ±' ? 'EGP' : 'SAR',
        order_id: orderNumber
    });
} catch (pixelError) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø­Ø¯Ø« ÙÙŠØ³Ø¨ÙˆÙƒ:', pixelError);
}
// ===================== END FACEBOOK PURCHASE TRACKING =====================
                    console.log('ğŸŠ ØªÙ…Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!');
                    console.log('ğŸ“Š Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:', orderNumber);
                    console.log('ğŸ“ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙÙˆØ±Ø§Ù‹');
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    setTimeout(() => {
                        showToast('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    }, 2000);

                } catch (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨:', error);
                    console.error('ğŸ”§ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£:', error.message);
                    
                    // Fallback: Save locally anyway
                    const localOrderNumber = Math.floor(10000 + Math.random() * 90000);
                    orderData.orderNumber = localOrderNumber;
                    orderData.createdAt = new Date().toISOString();
                    
                    saveOrderToLocalStorage(orderData, localOrderNumber);
                    
                    alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.\nØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø­Ù„ÙŠØ§Ù‹ ÙˆØ³ÙŠØªÙ… Ù…Ø¹Ø§Ù„Ø¬ØªÙ‡ ÙŠØ¯ÙˆÙŠØ§Ù‹.\nØ±Ù‚Ù… Ø·Ù„Ø¨Ùƒ: ' + localOrderNumber);
                    
                    showSuccessModal(localOrderNumber);
                    
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨';
                }
            });
        }

        // Validate Form
        function validateForm() {
            const requiredFields = ['fullName', 'phone', 'email', 'governorate', 'city', 'address'];
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger)';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            // Validate email format
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email && !emailRegex.test(email)) {
                document.getElementById('email').style.borderColor = 'var(--danger)';
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­');
                isValid = false;
            }
            
            if (!document.getElementById('terms').checked) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…');
                isValid = false;
            }
            
            return isValid;
        }

        // Create Order Data
        function createOrderData() {
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            
            // Determine which discount type was applied
            let discountType = 'none';
            let discountDescription = '';
            let discountValue = 0;
            let freeShippingApplied = false;
            
            if (isDiscountApplied && appliedDiscountCode) {
                discountType = 'code';
                const discountInfo = discountCodes[selectedCountry]?.find(d => d.code === appliedDiscountCode);
                discountDescription = discountInfo?.description || '';
                discountValue = discountInfo?.discountValue || 0;
                freeShippingApplied = discountInfo?.freeShipping || false;
            } else if (isQuantityDiscountApplied) {
                discountType = 'quantity';
                const totalQuantity = cart.reduce((sum, item) => sum + item.quantity, 0);
                const countryRules = quantityDiscountRules[selectedCountry] || {};
                let applicableRule = null;
                
                if (totalQuantity >= 5) {
                    applicableRule = countryRules[5];
                }
                
                discountDescription = applicableRule?.description || '';
                discountValue = applicableRule?.discountPercent || 0;
                freeShippingApplied = applicableRule?.freeShipping || false;
            }
            
            const orderData = {
                customer: {
                    name: document.getElementById('fullName').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    country: selectedCountry,
                    address: {
                        country: selectedCountry,
                        governorate: document.getElementById('governorate').value,
                        city: document.getElementById('city').value,
                        details: document.getElementById('address').value
                    }
                },
                items: cart,
                payment: {
                    method: paymentMethod,
                    status: 'pending'
                },
                paymentStatus: 'pending',
                totals: {
                    subtotal: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                    shipping: shippingCost,
                    total: finalTotal,
                    currency: getCurrency()
                },
                discount: {
                    type: discountType,
                    applied: isDiscountApplied || isQuantityDiscountApplied,
                    code: appliedDiscountCode,
                    amount: discountAmount + quantityDiscountAmount,
                    originalTotal: originalTotal,
                    description: discountDescription,
                    discountValue: discountValue,
                    freeShipping: freeShippingApplied,
                    quantity: cart.reduce((sum, item) => sum + item.quantity, 0)
                },
                status: 'Ø¬Ø¯ÙŠØ¯',
                notes: '',
                createdAt: new Date().toISOString()
            };
            
            return orderData;
        }

        // ===================== FIREBASE SAVE FUNCTION =====================
        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ø·Ù„Ø¨
        async function getNextOrderNumber() {
            try {
                // ØªØ­Ù‚Ù‚ Ù…Ù† localStorage Ø£ÙˆÙ„Ø§Ù‹
                const lastOrderStr = localStorage.getItem('lastOrderNumber');
                let nextNumber = 1;
                
                if (lastOrderStr) {
                    nextNumber = parseInt(lastOrderStr) + 1;
                }
                
                // Ø­Ø§ÙˆÙ„ Ø§Ù„Ø­ØµÙˆÙ„ Ù…Ù† Firebase counter
                try {
                    const counterRef = db.collection('counters').doc('orderCounter');
                    const counterDoc = await counterRef.get();
                    
                    if (counterDoc.exists) {
                        const firebaseCount = counterDoc.data().count + 1;
                        // Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø£ÙƒØ¨Ø±
                        nextNumber = Math.max(nextNumber, firebaseCount);
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ ÙÙŠ Firebase
                    await counterRef.set({ count: nextNumber }, { merge: true });
                } catch (firebaseError) {
                    console.warn('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¹Ø¯Ø§Ø¯ Firebase:', firebaseError);
                }
                
                // Ø­ÙØ¸ ÙÙŠ localStorage
                localStorage.setItem('lastOrderNumber', nextNumber.toString());
                
                return nextNumber;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:', error);
                // Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ ÙØ´Ù„ ÙƒÙ„ Ø´ÙŠØ¡
                return Math.floor(1000 + Math.random() * 9000);
            }
        }

        // Save Order to Firebase
        async function saveOrderToFirebase(orderData) {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase...');
            
            try {
                // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ
                const orderNumber = await getNextOrderNumber();
                console.log('ğŸ”¢ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ:', orderNumber);
                
                // 2. ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯)
                const now = new Date();
                const formattedDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                
                console.log('ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ:', formattedDate);
                
                // 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù€ Firebase (Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯)
                const firebaseData = {
                    orderNumber: orderNumber.toString(),
                    orderId: orderNumber.toString(),
                    
                    customer: {
                        name: orderData.customer.name,
                        phone: orderData.customer.phone,
                        email: orderData.customer.email,
                        country: orderData.customer.country,
                        address: {
                            country: orderData.customer.address.country,
                            governorate: orderData.customer.address.governorate,
                            city: orderData.customer.address.city,
                            details: orderData.customer.address.details
                        }
                    },
                    
                    items: orderData.items,
                    
                    payment: {
                        method: orderData.payment.method,
                        status: 'pending'
                    },
                    
                    paymentStatus: 'pending',
                    
                    totals: {
                        subtotal: orderData.totals.subtotal,
                        shipping: orderData.totals.shipping,
                        total: orderData.totals.total,
                        currency: orderData.totals.currency
                    },
                    
                    discount: {
                        type: orderData.discount.type,
                        applied: orderData.discount.applied,
                        code: orderData.discount.code || '',
                        amount: orderData.discount.amount || 0,
                        originalTotal: orderData.discount.originalTotal || orderData.totals.total,
                        description: orderData.discount.description || '',
                        discountValue: orderData.discount.discountValue || 0,
                        freeShipping: orderData.discount.freeShipping || false,
                        quantity: orderData.discount.quantity || 0
                    },
                    
                    status: 'Ø¬Ø¯ÙŠØ¯',
                    
                    createdAt: formattedDate,
                    createdAtTimestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    
                    notes: '',
                    source: 'checkout-page',
                    version: '2.0'
                };
                
                console.log('ğŸ“¦ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¶Ø±Ø© Ù„Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯:', firebaseData);
                
                // 4. Ø­ÙØ¸ ÙÙŠ Firebase (Ø§Ø³ØªØ®Ø¯Ù… orderNumber ÙƒÙ…Ø³ØªÙ†Ø¯ ID)
                const orderRef = db.collection('orders').doc(orderNumber.toString());
                await orderRef.set(firebaseData);
                
                console.log('âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Firebase!');
                console.log('ğŸ“ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯:', orderNumber.toString());
                console.log('ğŸ“Š Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:', orderNumber);
                console.log('ğŸ‘ï¸ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ÙÙˆØ±Ø§Ù‹');
                
                return orderNumber;
                
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase:', error);
                console.error('ğŸ”§ ÙƒÙˆØ¯ Ø§Ù„Ø®Ø·Ø£:', error.code);
                console.error('ğŸ”§ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£:', error.message);
                
                throw new Error(`ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Firebase: ${error.message}`);
            }
        }

        // Save Order to LocalStorage
        function saveOrderToLocalStorage(orderData, orderNumber) {
            try {
                const orderToSave = {
                    orderNumber: orderNumber,
                    orderId: orderNumber.toString(),
                    customer: {
                        name: orderData.customer.name,
                        phone: orderData.customer.phone,
                        email: orderData.customer.email,
                        country: orderData.customer.country,
                        address: {
                            country: orderData.customer.address.country,
                            governorate: orderData.customer.address.governorate,
                            city: orderData.customer.address.city,
                            details: orderData.customer.address.details
                        }
                    },
                    items: orderData.items,
                    payment: {
                        method: orderData.payment.method,
                        status: 'pending'
                    },
                    paymentStatus: 'pending',
                    totals: {
                        subtotal: orderData.totals.subtotal,
                        shipping: orderData.totals.shipping,
                        total: orderData.totals.total,
                        currency: orderData.totals.currency
                    },
                    discount: {
                        type: orderData.discount.type,
                        applied: orderData.discount.applied,
                        code: orderData.discount.code || '',
                        amount: orderData.discount.amount || 0,
                        originalTotal: orderData.discount.originalTotal || orderData.totals.total,
                        description: orderData.discount.description || '',
                        discountValue: orderData.discount.discountValue || 0,
                        freeShipping: orderData.discount.freeShipping || false,
                        quantity: orderData.discount.quantity || 0
                    },
                    status: 'Ø¬Ø¯ÙŠØ¯',
                    createdAt: new Date().toISOString(),
                    source: 'checkout-page'
                };
                
                // Save to main orders
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                orders.push(orderToSave);
                localStorage.setItem('orders', JSON.stringify(orders));
                
                // Also save to new_orders for immediate access
                const newOrders = JSON.parse(localStorage.getItem('new_orders')) || [];
                newOrders.push(orderToSave);
                localStorage.setItem('new_orders', JSON.stringify(newOrders));
                
                console.log('ğŸ’¾ ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙŠ localStorage Ø¨Ù†ÙØ³ Ù‡ÙŠÙƒÙ„ Firebase');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ localStorage:', error);
            }
        }

        // Show Success Modal
        function showSuccessModal(orderNumber) {
            const now = new Date();
            const formattedDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            document.getElementById('orderId').textContent = `#${orderNumber}`;
            document.getElementById('orderDate').textContent = formattedDate;
            document.getElementById('successModal').classList.add('show');
            
            // Auto close after 10 seconds
            setTimeout(() => {
                document.getElementById('successModal').classList.remove('show');
            }, 10000);
        }

        // Send WhatsApp Notification to Admin
        function sendWhatsAppNotification(orderNumber, orderData) {
            const phone = '966547856086'; // Admin phone number
            
            let paymentText = '';
            let paymentAlert = '';
            
            if (selectedCountry === 'Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©') {
                if (orderData.payment.method === 'bank-transfer') {
                    paymentText = 'ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else if (orderData.payment.method === 'stc-pay') {
                    paymentText = 'STC Pay';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… STC Pay Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else {
                    paymentText = 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                    paymentAlert = 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                }
            } else {
                if (orderData.payment.method === 'vodafone-cash') {
                    paymentText = 'ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else if (orderData.payment.method === 'instapay') {
                    paymentText = 'Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ';
                    paymentAlert = 'Ø³Ù†Ø±Ø³Ù„ Ø±Ù‚Ù… Ø§Ù†Ø³ØªØ§ Ø¨Ø§ÙŠ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨';
                } else {
                    paymentText = 'Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                    paymentAlert = 'Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…';
                }
            }
            
            // Add discount information to message
            let discountInfo = '';
            if (orderData.discount.applied) {
                discountInfo = `ğŸ‰ Ø§Ù„Ø®ØµÙ…: ${orderData.discount.description}
ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£ØµÙ„ÙŠ: ${orderData.discount.originalTotal} ${orderData.totals.currency}
âœ… Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${orderData.totals.total} ${orderData.totals.currency}
ğŸ’² Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…: ${orderData.discount.amount} ${orderData.totals.currency}
${orderData.discount.freeShipping ? 'ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„: Ù…Ø¬Ø§Ù†ÙŠ' : ''}
`;
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±
            const now = new Date();
            const notificationDate = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            const message = `ğŸ‰ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${orderNumber}
ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${notificationDate}
ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${orderData.customer.name}
ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${orderData.customer.phone}
ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${orderData.customer.email}
ğŸ“ Ø§Ù„Ø¨Ù„Ø¯: ${orderData.customer.address.country}
ğŸ›ï¸ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${orderData.customer.address.governorate}
ğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${orderData.customer.address.city}
ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${orderData.customer.address.details}
${discountInfo}
ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${orderData.totals.total} ${orderData.totals.currency}
ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${paymentText}
ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${orderData.items.length}
${paymentAlert}`;
            
            const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
            
            // Open WhatsApp in new tab
            window.open(whatsappUrl, '_blank');
        }

        // Show Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            // Add styles if not already added
            if (!document.querySelector('#toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    .toast-notification {
                        position: fixed;
                        top: 100px;
                        right: 20px;
                        background: var(--success);
                        color: white;
                        padding: 15px 20px;
                        border-radius: var(--radius);
                        z-index: 2000;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                        animation: slideInRight 0.3s ease;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    }
                    .toast-notification.error {
                        background: var(--danger);
                    }
                    .toast-notification i {
                        font-size: 1.2rem;
                    }
                    @keyframes slideInRight {
                        from {
                            opacity: 0;
                            transform: translateX(100%);
                        }
                        to {
                            opacity: 1;
                            transform: translateX(0);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease forwards';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
